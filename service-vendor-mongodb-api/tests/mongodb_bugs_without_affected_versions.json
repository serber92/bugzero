[
  {
    "title": "[SERVER-EXAMPLE-1] A bug without versions that should be skipped",
    "link": "https://jira.mongodb.org/browse/SERVER-EXAMPLE-1",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p><a href=\"https://github.com/mongodb/mongo/blob/afcb670f36b9cabda26d719c81f3991b9b2ed5b8/src/mongo/db/s/shard_server_catalog_cache_loader.cpp#L253\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">Reads</a> on a collection in the ShardServerCatalogCacheLoader <a href=\"https://github.com/mongodb/mongo/blob/afcb670f36b9cabda26d719c81f3991b9b2ed5b8/src/mongo/db/s/shard_server_catalog_cache_loader.cpp#L397\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">scheduled as part of the call to getChunksSince</a> can conflict with <a href=\"https://github.com/mongodb/mongo/blob/afcb670f36b9cabda26d719c81f3991b9b2ed5b8/src/mongo/db/s/shard_server_catalog_cache_loader.h#L498\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">other tasks</a> scheduled for the same collection, such as <a href=\"https://github.com/mongodb/mongo/blob/afcb670f36b9cabda26d719c81f3991b9b2ed5b8/src/mongo/db/s/shard_server_catalog_cache_loader.cpp#L1000\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">drops</a>. These should either be serialized or the <a href=\"https://github.com/mongodb/mongo/blob/8cbbba49935f632e876037f9f2d9eecc779eb96a/src/mongo/db/s/shard_metadata_util.cpp#L143-L145\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">read</a> should be made to not yield.</p>",
    "environment": "",
    "key": {
      "id": "746362",
      "content": "SERVER-40865"
    },
    "summary": "The ShardServerCatalogCacheLoader does not serialize read operations with other operations for the same collection",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "1",
      "content": "Fixed"
    },
    "assignee": {
      "username": "pierlauro.sciarelli",
      "content": "Pierlauro Sciarelli"
    },
    "reporter": {
      "username": "matthew.saltz",
      "content": "Matthew Saltz"
    },
    "labels": "",
    "created": "Fri, 26 Apr 2019 21:18:24 +0000",
    "updated": "Tue, 21 Sep 2021 07:49:50 +0000",
    "resolved": "Tue, 31 Aug 2021 15:03:10 +0000",
    "version": [
    ],
    "fixVersion": [
      "5.1.0",
      "5.0.4"
    ],
    "component": "Sharding",
    "votes": "0",
    "watches": "6",
    "comments": {
      "comment": [
        {
          "id": "3912380",
          "author": "ratika.gandhi",
          "created": "Thu, 1 Jul 2021 15:14:09 +0000",
          "content": "<p>flagging this for scheduling because it has 7 BFs depended on it. It would be good to schedule this to be able to close the BFs. </p>"
        },
        {
          "id": "4031093",
          "author": "pierlauro.sciarelli",
          "created": "Tue, 31 Aug 2021 12:33:25 +0000",
          "content": "<p>Considering that all the failures are due to <tt>QueryPlanKilled</tt> exceptions, going to implement a solution that simply adds this error to the <a href=\"https://github.com/mongodb/mongo/blob/c96a409f1b61384d9ca5c464e9ec55b05f6507d5/src/mongo/s/catalog_cache.cpp#L264-L286\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">ones retried by the catalog cache</a> rather than introducing additional complexity: it's only needed an additional retry of the read to \"see\" eventual changes since drop is not yielding. This will also allow quick backports.</p>"
        },
        {
          "id": "4031507",
          "author": "xgen-internal-githook",
          "created": "Tue, 31 Aug 2021 14:50:39 +0000",
          "content": "<p>Author:</p>\n{'name': 'Pierlauro Sciarelli', 'email': 'pierlauro.sciarelli@mongodb.com', 'username': 'pierlauro'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-40865\" title=\"The ShardServerCatalogCacheLoader does not serialize read operations with other operations for the same collection\" class=\"issue-link\" data-issue-key=\"SERVER-40865\"><del>SERVER-40865</del></a> Retry QueryPlanKilled errors in the catalog cache<br/>\nBranch: master<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/a9c17e84f57070ab1021013ba9ca02a74c7c771e\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/a9c17e84f57070ab1021013ba9ca02a74c7c771e</a></p>"
        },
        {
          "id": "4072858",
          "author": "xgen-internal-githook",
          "created": "Mon, 20 Sep 2021 21:32:34 +0000",
          "content": "<p>Author:</p>\n{'name': 'Pierlauro Sciarelli', 'email': 'pierlauro.sciarelli@mongodb.com', 'username': 'pierlauro'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-40865\" title=\"The ShardServerCatalogCacheLoader does not serialize read operations with other operations for the same collection\" class=\"issue-link\" data-issue-key=\"SERVER-40865\"><del>SERVER-40865</del></a> Retry QueryPlanKilled errors in the catalog cache<br/>\nBranch: v5.0<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/5387de8c4fbe580bbb7bc246796a7491e9372e70\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/5387de8c4fbe580bbb7bc246796a7491e9372e70</a></p>"
        }
      ]
    },
    "issuelinks": {
      "issuelinktype": [
        {
          "id": "10420",
          "name": "Backports",
          "outwardlinks": {
            "description": "backported by"
          }
        },
        {
          "id": "10011",
          "name": "Depends",
          "inwardlinks": {
            "description": "is depended on by"
          }
        }
      ]
    },
    "attachments": "",
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "4.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "1.0"
          }
        },
        {
          "id": "customfield_12450",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes",
          "customfieldname": "Backport Requested",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "key": "21777",
                "content": "v5.0"
              },
              {
                "key": "18953",
                "content": "v4.4"
              },
              {
                "key": "16775",
                "content": "v4.2"
              },
              {
                "key": "15640",
                "content": "v4.0"
              }
            ]
          }
        },
        {
          "id": "customfield_10011",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Backwards Compatibility",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10038",
              "content": "Fully Compatible"
            }
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Thu, 1 Jul 2021 15:14:09 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        3 days ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_17050",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Downstream Team Attention",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "16941",
              "content": "Not Needed"
            }
          }
        },
        {
          "id": "customfield_10857",
          "key": "com.pyxis.greenhopper.jira:gh-epic-link",
          "customfieldname": "Epic Link",
          "customfieldvalues": {
            "customfieldvalue": "PM-2011"
          }
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "dbeng-pm-bot"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            3 days ago\n                        "
        },
        {
          "id": "customfield_16465",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Linked BF Score",
          "customfieldvalues": {
            "customfieldvalue": "140.0"
          }
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "xgen-internal-githook",
              "matthew.saltz",
              "pierlauro.sciarelli",
              "ratika.gandhi"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|huvu6f:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "0|i3irnb:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": {
              "id": "5180",
              "content": "Sharding EMEA 2021-09-06"
            }
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|huvgfr:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-51806] bulk key insertion phase of index build holds IX lock without yielding",
    "link": "https://jira.mongodb.org/browse/SERVER-51806",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>The key insertion phase of a hybrid index build seems to hold and not yield an IX (w) lock. Any single command with an S (R) lock can block all operations during that time. In this case the offending command seems to be the read-only profile command (<tt>profile: -1</tt>)</p>\n\n<h6><a name=\"originaldescription\"></a>original description</h6>\n\n<p>hello:<br/>\n my mongo cluster is 4.2.8 with six data node.today i create index with follow command:</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">db.monitorIn.createIndex({ org: 1.0, et: 1.0, pbOrg: 1.0 });\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p> index from 2020/10/22 09:58,to 10:30,all write is slow 10 times than before.it is :</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">Database: { acquireCount: { w: 3 }, acquireWaitCount: { w: 1 }, timeAcquiringMicros: { w: 3908088 } }.run in Index Build: inserting keys from </span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">external sorter into index mode,\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p>all write is blocking.</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:09.819+0800 I  INDEX    [conn997955] index build: inserted 439497660 keys from external sorter into index in 319 seconds.\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p>all write is blocked time :319 </p>\n\n<p>from 2020-10-22T12:28:update time is 288831.</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.853+0800 I  WRITE    [conn1004545] update expMonitordb.expInfos appName: \"monitor_in_out\" command: { q: { _id: \"YT4873152410671\", $or: [ { curT: { $exists: false } }, { curT: { $lt: new Date(1603336989000) } } ] }, u: { $set: { curT: new Date(1603336989000), currentOrg: \"454001\", currentOp: 131 } }, multi: false, upsert: false } planSummary: IXSCAN { _id: 1 } keysExamined:1 docsExamined:1 nMatched:1 nModified:1 numYields:0 queryHash:DE51A53B planCacheKey:2FB486A3 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 2 } }, ReplicationStateTransition: { acquireCount: { w: 2 } }, Global: { acquireCount: { w: 2 } }, Database: { acquireCount: { w: 2 }, acquireWaitCount: { w: 1 }, timeAcquiringMicros: { w: 288830662 } }, Collection: { acquireCount: { w: 2 } }, Mutex: { acquireCount: { r: 5 } } } flowControl:{ acquireCount: 1, timeAcquiringMicros: 1 } storage:{} 288831ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>",
    "environment": "",
    "key": {
      "id": "1522303",
      "content": "SERVER-51806"
    },
    "summary": "bulk key insertion phase of index build holds IX lock without yielding",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "1",
      "content": "Fixed"
    },
    "assignee": {
      "username": "yuhong.zhang",
      "content": "Yuhong Zhang"
    },
    "reporter": {
      "username": "601290552@qq.com",
      "content": "jing xu"
    },
    "labels": "",
    "created": "Thu, 22 Oct 2020 09:24:28 +0000",
    "updated": "Fri, 24 Sep 2021 03:56:49 +0000",
    "resolved": "Thu, 5 Aug 2021 13:54:25 +0000",
    "version": [

    ],
    "fixVersion": [
      "5.1.0",
      "5.0.4"
    ],
    "component": "Index Maintenance",
    "votes": "0",
    "watches": "22",
    "comments": {
      "comment": [
        {
          "id": "3458740",
          "author": "601290552@qq.com",
          "created": "Thu, 22 Oct 2020 09:27:32 +0000",
          "content": "<p>create index from 2020/10/22 09:58:00 to 2020/10/22 12:28:00.<br/>\nbut from 10:30 to 12:30.connections from 150 to 1000.so it effect system.<br/>\n4.2 create index is online,why blocking write for Index Build: inserting keys from external sorter into index mode and other time update is slow 10 times from   normal time?<br/>\nso create index has two problems:<br/>\none problem is :create index is running,but .create index execute more than 30 minutes,so <br/>\ndatabase begin to deal with update slowly, more than 10 times on begin to create index or before create index.<br/>\ntwo problem is:Index Build: inserting keys from external sorter into index,so that database is blocking all request.</p>\n\n<p>from 10:32: normal update is 155ms,after update is 3909ms,so it spends time on timeAcquiringMicros: </p>\n{ w: 3908088 }\n<p>. </p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T10:32:19.127+0800 I  COMMAND  [conn999225] command expMonitordb.$cmd appName: \"monitor_in_out\" command: update { update: \"monitorOut\", bypassDocumentValidation: false, ordered: true, stmtIds: [ 0 ], updates: [ { q: { org: \"571038\", ct: new Date(1602241845000), no: \"YT2092258602172\" }, u: { $set: { curCode: 131, curEmp: \"00754344\", curOrg: \"571901\", curT: new Date(1603333798000), preOrg: \"571901\", nextOrg: \"571038\", st: new Date(1603333938954), status: 4, ioType: \"01\" } }, multi: false, upsert: true } ], runtimeConstants: { localNow: new Date(1603333938972), clusterTime: Timestamp(1603333938, 4789) }, shardVersion: [ Timestamp(21262, 9), ObjectId('5f0ee7bb9a174cbcccb36243') ], allowImplicitCollectionCreation: false, lsid: { id: UUID(\"09afed15-ad59-4bf8-939d-ecea3d219183\"), uid: BinData(0, F26770D132634AFD9C12F0330423A9A86C8757FAA1BC0F272877335651AAEA5A) }, txnNumber: 1947281, $clusterTime: { clusterTime: Timestamp(1603333938, 4789), signature: { hash: BinData(0, 83C0AA143F1BE5725E52C85B2425E2DD8C438C87), keyId: 6844800181754396704 } }, $audit: { $impersonatedUsers: [ { user: \"lhexp\", db: \"expMonitordb\" } ], $impersonatedRoles: [ { role: \"readWrite\", db: \"expMonitordb\" } ] }, $client: { driver: { name: \"mongo-java-driver|sync\", version: \"4.0.5\" }, os: { type: \"Linux\", name: \"Linux\", architecture: \"amd64\", version: \"3.10.0-693.21.1.el7.x86_64\" }, platform: \"Java/Oracle Corporation/1.8.0_172-b11\", application: { name: \"monitor_in_out\" }, mongos: { host: \"srvdb10.yto.cloud:21051\", client: \"10.7.53.133:45306\", version: \"4.2.8\" } }, $configServerState: { opTime: { ts: Timestamp(1603333938, 2583), t: 1 } }, $db: \"expMonitordb\" } numYields:1 reslen:426 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 5 } }, ReplicationStateTransition: { acquireCount: { w: 6 } }, Global: { acquireCount: { r: 1, w: 4 } }, Database: { acquireCount: { w: 4 } }, Collection: { acquireCount: { w: 4 } }, Metadata: { acquireCount: { W: 1 } }, Mutex: { acquireCount: { r: 8 } } } flowControl:{ acquireCount: 2 } storage:{} protocol:op_msg 155ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T10:32:23.462+0800 I  COMMAND  [conn999198] command expMonitordb.$cmd appName: \"monitor_in_out\" command: update { update: \"monitorOut\", bypassDocumentValidation: false, ordered: true, stmtIds: [ 0 ], updates: [ { q: { org: \"538001\", ct: new Date(1603189414000), no: \"YT4873213854502\" }, u: { $set: { curCode: 171, curEmp: \"01927198\", curOrg: \"280001\", curT: new Date(1603333774000), preOrg: null, nextOrg: \"\", st: new Date(1603333939119), status: 4, ioType: \"01\" } }, multi: false, upsert: true } ], runtimeConstants: { localNow: new Date(1603333939137), clusterTime: Timestamp(1603333939, 1195) }, shardVersion: [ Timestamp(21262, 9), ObjectId('5f0ee7bb9a174cbcccb36243') ], allowImplicitCollectionCreation: false, lsid: { id: UUID(\"1a38e17f-5d87-4734-9246-f1a57fc16c30\"), uid: BinData(0, F26770D132634AFD9C12F0330423A9A86C8757FAA1BC0F272877335651AAEA5A) }, txnNumber: 2029302, $clusterTime: { clusterTime: Timestamp(1603333939, 1195), signature: { hash: BinData(0, 747EE21466E6E579EB645F8D0541FBB587FB5D14), keyId: 6844800181754396704 } }, $audit: { $impersonatedUsers: [ { user: \"lhexp\", db: \"expMonitordb\" } ], $impersonatedRoles: [ { role: \"readWrite\", db: \"expMonitordb\" } ] }, $client: { driver: { name: \"mongo-java-driver|sync\", version: \"4.0.5\" }, os: { type: \"Linux\", name: \"Linux\", architecture: \"amd64\", version: \"3.10.0-693.21.1.el7.x86_64\" }, platform: \"Java/Oracle Corporation/1.8.0_172-b11\", application: { name: \"monitor_in_out\" }, mongos: { host: \"srvdb10.yto.cloud:21051\", client: \"10.7.53.132:58114\", version: \"4.2.8\" } }, $configServerState: { opTime: { ts: Timestamp(1603333938, 2583), t: 1 } }, $db: \"expMonitordb\" } numYields:0 reslen:426 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 4 } }, ReplicationStateTransition: { acquireCount: { w: 5 } }, Global: { acquireCount: { r: 1, w: 3 } },           Database: { acquireCount: { w: 3 }, acquireWaitCount: { w: 1 }, timeAcquiringMicros: { w: 3908088 } }, Collection: { acquireCount: { w: 3 } }, Metadata: { acquireCount: { W: 1 }, acquireWaitCount: { W: 1 }, timeAcquiringMicros: { W: 34 } }, Mutex: { acquireCount: { r: 8 } } } flowControl:{ acquireCount: 1 } storage:{} protocol:op_msg 3909ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>"
        },
        {
          "id": "3458912",
          "author": "601290552@qq.com",
          "created": "Thu, 22 Oct 2020 12:43:51 +0000",
          "content": "<p>i will upload shard1  primary log including:mongo slow log and diag log.<br/>\n<del>rw</del>------ 1 mongo mongo 10410467 Oct 22 08:17 metrics.2020-10-21T19-47-05Z-00000<br/>\n<del>rw</del>------ 1 mongo mongo 10489382 Oct 22 12:31 metrics.2020-10-22T00-17-05Z-00000<br/>\n<del>rw</del>------ 1 mongo mongo 10472702 Oct 22 16:31 metrics.2020-10-22T04-31-37Z-00000<br/>\n<del>rw</del>------ 1 mongo mongo 10336305 Oct 22 20:31 metrics.2020-10-22T08-31-42Z-00000<br/>\n<del>rw</del>------ 1 mongo mongo   872577 Oct 22 20:51 metrics.2020-10-22T12-31-43Z-00000</p>"
        },
        {
          "id": "3462402",
          "author": "601290552@qq.com",
          "created": "Sun, 25 Oct 2020 01:02:10 +0000",
          "content": "<p>hello:<br/>\n   please help me deal with it.need to other diag log?if too long time,some diag log would be lost.tks. </p>"
        },
        {
          "id": "3464008",
          "author": "601290552@qq.com",
          "created": "Mon, 26 Oct 2020 22:46:09 +0000",
          "content": "<p>1、please help me analyze metrics from 2020-10-22 08:00:00+08:00 to 16:00:00+08:00,because the problem begin at 2020-10-22 10:30:00+08:00,index create time is 2020-10-22 09:58:00+08:00,the issue stop time is 2020-10-22 14:00:00+08:00.analyze metrics,  it would include connections and flowcontrol metrics?</p>\n\n<p>2、please help analyze how and why  create index influence db performance about response time  and final blocking all write?</p>"
        },
        {
          "id": "3464021",
          "author": "eric.sedor",
          "created": "Mon, 26 Oct 2020 23:07:14 +0000",
          "content": "<p><a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=601290552%40qq.com\" class=\"user-hover\" rel=\"601290552@qq.com\">jing xu</a> we are investigating and apologize for the delay.</p>"
        },
        {
          "id": "3464086",
          "author": "601290552@qq.com",
          "created": "Tue, 27 Oct 2020 00:44:30 +0000",
          "content": "<p>hi Eric Sedor:<br/>\n  thank you very much. i am waiting for it</p>"
        },
        {
          "id": "3470501",
          "author": "601290552@qq.com",
          "created": "Sat, 31 Oct 2020 08:19:47 +0000",
          "content": "<p>hi Eric:<br/>\n   What is the current progress？</p>\n\n\n\n"
        },
        {
          "id": "3474756",
          "author": "eric.sedor",
          "created": "Tue, 3 Nov 2020 22:27:54 +0000",
          "content": "<p>Hi <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=601290552%40qq.com\" class=\"user-hover\" rel=\"601290552@qq.com\">jing xu</a>, thanks for your patience so far. I've compiled my observations but have not identified a clear cause yet.</p>\n\n<p>From the diagnostic data we see queueing from 2020-10-22T12:23:19.232Z+0800 to 2020-10-22T12:28:10.906+0800. This occurs during the bulk key insertion for a 2.5 hour index build on the expMonitordb.monitorIn collection, but does not coincide directly with that bulk key insertion. The queuing most closely coincides with a 291318ms update to the expMonitordb.monitorIn collection, which is blocked acquiring the Database.timeAcquiringMicros.w lock for almost all of its execution time. It's not yet clear what the blocking operation was.</p>\n\n<p>A few notes:</p>\n\n<ul>\n\t<li>The \"Detected blocked worker threads, starting new thread to unblock service executor\" log line occurs many times in the provided logs, oftentimes multiple times a minute. The first and last line are noted in the timeline.</li>\n</ul>\n\n\n<ul>\n\t<li>createIndex for lastUse:1 in system.sessions is logged twice during the provided logs, and multiple other createIndex commands are reported in diagnostic data. One of those commands runs long during the period of queueing and is noted in the timeline below.</li>\n</ul>\n\n\n<p>The timeline:</p>\n\n<p> <span class=\"image-wrap\" style=\"\"><img src=\"https://jira.mongodb.org/secure/attachment/285608/285608_Screen+Shot+2020-11-03+at+2.27.31+PM.png\" width=\"100%\" style=\"border: 0px solid black\" /></span> </p>\n\n<ul>\n\t<li>2020-10-22T09:58:11.342+0800 - (Not pictured) Index build on expMonitordb.monitorIn ( \n{ org: 1.0, et: 1.0, pbOrg: 1.0 }\n<p> ) begins</p></li>\n</ul>\n\n\n<ul>\n\t<li>2020-10-22T10:04:20.249+080 - (Not pictured) The first \"Detected blocked worker threads\" line in the provided logs</li>\n</ul>\n\n\n<ul>\n\t<li>2020-10-22T12:22:53.020+0800 - (A) bulk key inserts for the expMonitordb.monitorIn ( {{{ org: 1.0, et: 1.0, pbOrg: 1.0 }}}) index begin</li>\n</ul>\n\n\n<ul>\n\t<li>2020-10-22T12:23:19.232Z+0800 - (B) Queueing begins, a createIndexes command is reported in diagnostic data (could not correlate with a log entry), the noted long-running (291318ms) update to expMonitordb.monitorIn begins</li>\n</ul>\n\n\n<ul>\n\t<li>2020-10-22T12:25:36.000+0800 - (D) Index build on system.sessions (lastUse:1) begins</li>\n</ul>\n\n\n<ul>\n\t<li>2020-10-22T12:28:10.809+0800- (~E) The last \"Detected blocked worker threads, starting new thread to unblock service executor\" for a while</li>\n</ul>\n\n\n<ul>\n\t<li>2020-10-22T12:28:10.890+0800 - (E) Index build on system.sessions (lastUse:1) completes after 154678ms.</li>\n</ul>\n\n\n<ul>\n\t<li>2020-10-22T12:28:10.906+0800 - (F) An update to expMonitordb.monitorIn completes after 291318ms (with Database.timeAcquiringMicros.w: 291264650), queues resolve</li>\n</ul>\n\n\n<ul>\n\t<li>2020-10-22T12:28:51.133+0800 - (G) Index build on expMonitordb.monitorIn ( {{{ org: 1.0, et: 1.0, pbOrg: 1.0 }}} ) completes after 9039886ms. At this time, we see the lock acquisition for the collection W lock that the end of the long-running index build should need.</li>\n</ul>\n"
        },
        {
          "id": "3475122",
          "author": "601290552@qq.com",
          "created": "Wed, 4 Nov 2020 06:11:52 +0000",
          "content": "<p>hi:<br/>\n  thank you for very much,but i have some problem for it:<br/>\n1、from 09:58 to 10:30,update slow than before. 2020-10-22T10:04:20.249+080 - (Not pictured) The first \"Detected blocked worker threads\" line in the provided logs,online ddl why blocking?<br/>\n2、why 2020-10-22T12:23:19 to 2020-10-22T12:28:10.906 ,blocking all thread?<br/>\nso it is a bug for online ddl ?</p>\n\n<p>3、why it need so long for Database.timeAcquiringMicros?because online ddl for index?<br/>\nAn update to expMonitordb.monitorIn completes after 291318ms (with Database.timeAcquiringMicros.w: 291264650)</p>\n\n<p>4、from shard1.log about create index:</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T09:58:11.342+0800 I  INDEX    [conn997955] index build: starting on expMonitordb.monitorIn properties: { v: 2, key: { org: 1.0, et: 1.0, pbOrg: 1.0 }, name: \"org_1_et_1_pbOrg_1\", ns: \"expMonitordb.monitorIn\" } using method: Hybrid</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T09:58:11.342+0800 I  INDEX    [conn997955] build may temporarily use up to 200 megabytes of RAM</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\">&nbsp;</pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:51.133+0800 I  COMMAND  [conn997955] command expMonitordb.monitorIn appName: \"MongoDB Shell\" command: createIndexes { createIndexes: \"monitorIn\", indexes: [ { key: { org: 1.0, et: 1.0, pbOrg: 1.0 }, name: \"org_1_et_1_pbOrg_1\" } ], allowImplicitCollectionCreation: false, lsid: { id: UUID(\"6b1368d9-beec-41c4-ae80-1d751b2c264a\"), uid: BinData(0, 3B408CB48548B5037822C10EB0976B3CBF2CEE3BF9C708796BF03941FBECD80F) }, $clusterTime: { clusterTime: Timestamp(1603331891, 974), signature: { hash: BinData(0, 77EDCB6E8F0CD34729DB9B51B23ED53E36B45D74), keyId: 6844800181754396704 } }, $audit: { $impersonatedUsers: [ { user: \"admin\", db: \"admin\" } ], $impersonatedRoles: [ { role: \"root\", db: \"admin\" } ] }, $client: { application: { name: \"MongoDB Shell\" }, driver: { name: \"MongoDB Internal Client\", version: \"4.2.8\" }, os: { type: \"Linux\", name: \"CentOS Linux release 7.6.1810 (Core) \", architecture: \"x86_64\", version: \"Kernel 3.10.0-957.el7.x86_64\" }, mongos: { host: \"srvdb6.yto.cloud:21051\", client: \"127.0.0.1:57948\", version: \"4.2.8\" } }, $configServerState: { opTime: { ts: Timestamp(1603331890, 3311), t: 1 } }, $db: \"expMonitordb\" } numYields:3447957 reslen:409 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 3447959 } }, ReplicationStateTransition: { acquireCount: { w: 3447960 } }, Global: { acquireCount: { r: 1, w: 3447959 } }, Database: { acquireCount: { r: 1, w: 3447959 }, acquireWaitCount: { w: 136 }, timeAcquiringMicros: { w: 164847 } }, Collection: { acquireCount: { r: 3447959, w: 1, R: 1, W: 2 } }, Mutex: { acquireCount: { r: 4 } } } flowControl:{ acquireCount: 3447958, timeAcquiringMicros: 1215115 } storage:{ data: { bytesRead: 580449277358, bytesWritten: 2598814, timeReadingMicros: 4797651363, timeWritingMicros: 1985 } } protocol:op_msg 9039886ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\">&nbsp;</pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\">&nbsp;</pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:51.106+0800 I  INDEX    [conn997955] index build: drain applied 1444434 side writes (inserted: 694530, deleted: 749904) for 'org_1_et_1_pbOrg_1' in 40458 ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p>5、default active create index 3. i only create one index<br/>\n    cpp_varname: maxNumActiveUserIndexBuilds<br/>\n    default: 3<br/>\n    validator:<br/>\n      gte: 0</p>"
        },
        {
          "id": "3475176",
          "author": "601290552@qq.com",
          "created": "Wed, 4 Nov 2020 08:32:29 +0000",
          "content": "<p>why mongodb auto create index for system.sessions.another i create index for monitorIn from 09:58.so They are not related,the system begin slow from 10:00,config.$cmd command: createIndexes from 11:23.</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T11:23:35.956+0800 I  COMMAND  [conn1000118] command config.$cmd command: createIndexes { createIndexes: \"system.sessions\", indexes: [ { key: { lastUse: 1 }, name: \"lsidTTLIndex\", expireAfterSeconds: 1800 } ], allowImplicitCollectionCreation: false, $clusterTime: { clusterTime: Timestamp(1603337013, 9), signature: { hash: BinData(0, 4C51EDBABAE3332C5329CA971C5C84D7085BDCBD), keyId: 6844800181754396704 } }, $configServerState: { opTime: { ts: Timestamp(1603337013, 9), t: 1 } }, $db: \"config\" } numYields:0 reslen:412 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 2 } }, ReplicationStateTransition: { acquireCount: { w: 2 } }, Global: { acquireCount: { w: 2 } }, Database: { acquireCount: { w: 2 } }, Collection: { acquireCount: { w: 1 } }, Mutex: { acquireCount: { r: 1 } } } flowControl:{ acquireCount: 1 } protocol:op_msg 1682ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.890+0800 I  COMMAND  [conn1004100] command config.$cmd command: createIndexes { createIndexes: \"system.sessions\", indexes: [ { key: { lastUse: 1 }, name: \"lsidTTLIndex\", expireAfterSeconds: 1800 } ], allowImplicitCollectionCreation: false, $clusterTime: { clusterTime: Timestamp(1603340735, 45), signature: { hash: BinData(0, 391B4D5FFCC8F50FD773E00F8797B52B50C30F8B), keyId: 6844800181754396704 } }, $configServerState: { opTime: { ts: Timestamp(1603340735, 45), t: 1 } }, $db: \"config\" } numYields:0 reslen:412 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 2 } }, ReplicationStateTransition: { acquireCount: { w: 2 } }, Global: { acquireCount: { w: 2 } }, Database: { acquireCount: { w: 2 } }, Collection: { acquireCount: { w: 1 } }, Mutex: { acquireCount: { r: 1 } } } flowControl:{ acquireCount: 1 } protocol:op_msg 154678ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>"
        },
        {
          "id": "3475721",
          "author": "601290552@qq.com",
          "created": "Wed, 4 Nov 2020 15:24:49 +0000",
          "content": "<p>hi:<br/>\nthe complete create index log:</p>\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T09:58:11.342+0800 I  INDEX    [conn997955] index build: starting on expMonitordb.monitorIn properties: { v: 2, key: { org: 1.0, et: 1.0, pbOrg: 1.0 }, name: \"org_1_et_1_pbOrg_1\", ns: \"expMonitordb.monitorIn\" } using method: Hybrid</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T09:58:11.342+0800 I  INDEX    [conn997955] build may temporarily use up to 200 megabytes of RAM</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T09:58:14.000+0800 I  -        [conn997955]   Index Build: scanning collection: 444500/438835262 0%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:22:48.001+0800 I  -        [conn997955]   Index Build: scanning collection: 438989200/438794149 100%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:22:50.791+0800 I  INDEX    [conn997955] index build: collection scan done. scanned 439497660 total records in 8679 seconds</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:22:57.001+0800 I  -        [conn997955]   Index Build: inserting keys from external sorter into index: 3930000/439497660 0%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:09.001+0800 I  -        [conn997955]   Index Build: inserting keys from external sorter into index: 438294000/439497660 99%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:09.819+0800 I  INDEX    [conn997955] index build: inserted 439497660 keys from external sorter into index in 319 seconds</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:13.104+0800 I  -        [conn997955]   Index Build: draining writes received during build: 19000/1428254 1%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:49.018+0800 I  -        [conn997955]   Index Build: draining writes received during build: 1309000/1444293 90%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:51.106+0800 I  INDEX    [conn997955] index build: drain applied 1444434 side writes (inserted: 694530, deleted: 749904) for 'org_1_et_1_pbOrg_1' in 40458 ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:51.109+0800 I  INDEX    [conn997955] index build: done building index org_1_et_1_pbOrg_1 on ns expMonitordb.monitorIn</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:51.133+0800 I  COMMAND  [conn997955] command expMonitordb.monitorIn appName: \"MongoDB Shell\" command: createIndexes { createIndexes: \"monitorIn\", indexes: [ { key: { org: 1.0, et: 1.0, pbOrg: 1.0 }, name: \"org_1_et_1_pbOrg_1\" } ], allowImplicitCollectio</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">nCreation: false, lsid: { id: UUID(\"6b1368d9-beec-41c4-ae80-1d751b2c264a\"), uid: BinData(0, 3B408CB48548B5037822C10EB0976B3CBF2CEE3BF9C708796BF03941FBECD80F) }, $clusterTime: { clusterTime: Timestamp(1603331891, 974), signature: { hash: BinData(0, 77EDCB6E8F0CD34729DB9B</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">51B23ED53E36B45D74), keyId: 6844800181754396704 } }, $audit: { $impersonatedUsers: [ { user: \"admin\", db: \"admin\" } ], $impersonatedRoles: [ { role: \"root\", db: \"admin\" } ] }, $client: { application: { name: \"MongoDB Shell\" }, driver: { name: \"MongoDB Internal Client\", </span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">version: \"4.2.8\" }, os: { type: \"Linux\", name: \"CentOS Linux release 7.6.1810 (Core) \", architecture: \"x86_64\", version: \"Kernel 3.10.0-957.el7.x86_64\" }, mongos: { host: \"srvdb6.yto.cloud:21051\", client: \"127.0.0.1:57948\", version: \"4.2.8\" } }, $configServerState: { op</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">Time: { ts: Timestamp(1603331890, 3311), t: 1 } }, $db: \"expMonitordb\" } numYields:3447957 reslen:409 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 3447959 } }, ReplicationStateTransition: { acquireCount: { w: 3447960 } }, Global: { acquireCount: { r: 1, w: 3447</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">959 } }, Database: { acquireCount: { r: 1, w: 3447959 }, acquireWaitCount: { w: 136 }, timeAcquiringMicros: { w: 164847 } }, Collection: { acquireCount: { r: 3447959, w: 1, R: 1, W: 2 } }, Mutex: { acquireCount: { r: 4 } } } flowControl:{ acquireCount: 3447958, timeAcqu</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">iringMicros: 1215115 } storage:{ data: { bytesRead: 580449277358, bytesWritten: 2598814, timeReadingMicros: 4797651363, timeWritingMicros: 1985 } } protocol:op_msg 9039886ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>"
        },
        {
          "id": "3498632",
          "author": "eric.sedor",
          "created": "Thu, 19 Nov 2020 22:00:07 +0000",
          "content": "<p>Hi <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=601290552%40qq.com\" class=\"user-hover\" rel=\"601290552@qq.com\">jing xu</a>,</p>\n\n<p>Thanks for your patience. What we see happening is that a database lock is being taken during the \"key insertion\" phase of the index build, during the period covered by these log lines:</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:22:50.791+0800 I  INDEX    [conn997955] index build: collection scan done. scanned 439497660 total records in 8679 seconds</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:22:57.001+0800 I  -        [conn997955]   Index Build: inserting keys from external sorter into index: 3930000/439497660 0%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:09.001+0800 I  -        [conn997955]   Index Build: inserting keys from external sorter into index: 438294000/439497660 99%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:09.819+0800 I  INDEX    [conn997955] index build: inserted 439497660 keys from external sorter into index in 319 seconds\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p>During that time, the database lock is preventing lock acquisition by <tt>profile</tt> commands:</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.853+0800 I  COMMAND  [conn1004028] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340599, 25), signature: { hash: BinData(0, A6629B4A02DAC651DF672778E73312F2EA74749E), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 291292837 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 291293ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.871+0800 I  COMMAND  [conn1004431] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340658, 1), signature: { hash: BinData(0, CA4139178AC1DBD30A3698F87B4ED78A2D9F4A0B), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 231316757 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 231316ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.871+0800 I  COMMAND  [conn1005022] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340778, 1), signature: { hash: BinData(0, 4835199DFC366CF648820EBED7C6FC2F0DDA1E8E), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 111325056 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 111325ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.871+0800 I  COMMAND  [conn1005251] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340839, 26), signature: { hash: BinData(0, C73486F8FB0AF4EF9610EF9E7B35A8EE33BB513C), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 51140763 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 51140ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.872+0800 I  COMMAND  [conn1004828] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340718, 1), signature: { hash: BinData(0, F6E27F35CFCF27C982C9F761224F142F7AE8DC14), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 171096737 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 171097ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p>Since these operations require a lock that blocks other operations, all other operations are blocked on these. So you may be able to avoid blocking all updates by avoiding these repeated profile commands (which appear to be noops since they are all setting a profile level of -1).</p>"
        },
        {
          "id": "3499053",
          "author": "601290552@qq.com",
          "created": "Fri, 20 Nov 2020 02:35:47 +0000",
          "content": "<p> </p>\n\n<p>hi:</p>\n\n<p>1、i find</p>\n\n{profile: -1}\n\n<p>to get current settings,this command executed by mongo not me。<br/>\n i see it from doc.<br/>\n profile Changed in version 4.0: The command can be run on mongos with profile level:<br/>\n 0 to set the slowms and sampleRate for the system log; i.e. you cannot enable the profiler on a mongos.<br/>\n -1 to read the current settings.</p>\n\n<p>2、How often does this command execute and trigger conditions?</p>\n\n<p>i see 10-22 one day,profile:-1 executed from 00:00 to 21:15:19.</p>\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T00:00:19.597+0800 I  COMMAND  [conn993781] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603296019, 1166), signature: { hash: BinData(0, 356764A28D0C8DED53D9AACA08F951613B387793), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 137497 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 137ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T00:21:19.904+0800 I  COMMAND  [conn993781] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603297279, 1097), signature: { hash: BinData(0, A343F8473F97535F9E994775041E541F1348236D), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 418730 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 419ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T08:21:19.646+0800 I  COMMAND  [conn997203] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603326079, 2984), signature: { hash: BinData(0, A304633A5D5A8DD57FFC89CB5832F87FCEE6F68B), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 118882 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 119ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T10:04:28.325+0800 I  COMMAND  [conn998027] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603332259, 4739), signature: { hash: BinData(0, 08169BF64EE3CDF6CEF359A8733914D5E3C02152), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 8781646 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 8782ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T10:07:27.047+0800 I  COMMAND  [conn998206] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603332439, 1637), signature: { hash: BinData(0, DACFB13DB9C13F162AED8F039B25DFEAEB48FFA0), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 7516195 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 7517ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T10:08:19.761+0800 I  COMMAND  [conn998027] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603332499, 5149), signature: { hash: BinData(0, 487103B37E43D1763B1ED8AE26643CD3ECDD6872), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 110318 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 110ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.871+0800 I  COMMAND  [conn1005022] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340778, 1), signature: { hash: BinData(0, 4835199DFC366CF648820EBED7C6FC2F0DDA1E8E), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 111325056 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 111325ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.871+0800 I  COMMAND  [conn1005251] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340839, 26), signature: { hash: BinData(0, C73486F8FB0AF4EF9610EF9E7B35A8EE33BB513C), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 51140763 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 51140ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.872+0800 I  COMMAND  [conn1004828] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340718, 1), signature: { hash: BinData(0, F6E27F35CFCF27C982C9F761224F142F7AE8DC14), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 171096737 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 171097ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:49:19.641+0800 I  COMMAND  [conn1005455] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603342159, 3409), signature: { hash: BinData(0, 6C2272583614011BC3078BF0425E3354E7D9DF7A), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 106047 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 106ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T13:03:19.742+0800 I  COMMAND  [conn1006651] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603342999, 3763), signature: { hash: BinData(0, C965FAF80DC396D4A0A15412560603FAD97C0288), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 166112 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 166ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T16:37:20.123+0800 I  COMMAND  [conn1013065] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603355839, 6148), signature: { hash: BinData(0, BA20C801EC1FF2FCFFC987706128C844F7F81976), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 558182 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 558ms</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T21:15:19.700+0800 I  COMMAND  [conn1017680] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603372519, 8000), signature: { hash: BinData(0, 5791949A9D96BC21394EAF1A139FE4237DF5EACF), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 101372 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 101ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n<p>3、this profile command need to shard lock.how to block this command?<br/>\n i find external sorter into index:op_time:319s this hold w<br/>\n profile:-1:op_time:219s. this need R lock<br/>\n lock: external sorter into index block profile:-1,profile:-1 block other update.<br/>\n connections:from 103 to 1000.so this 391s connections not relese.<br/>\n from logs:2020-10-22T12:23:00 to 2020-10-22T12:28:09,there is no update or select .<br/>\n t think:profile:-1 is blocked by index,after profile:-1 block other all update.<br/>\n so profile:-1 This command doesn't make sense. how to disable it？</p>\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:23:00.001+0800 I  -        [conn997955]   Index Build: inserting keys from external sorter into index: 8411900/439497660 1%</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:09.819+0800 I  INDEX    [conn997955] index build: inserted 439497660 keys from external sorter into index in 319 seconds</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.247+0800 I  NETWORK  [listener] connection accepted from 10.5.130.54:54632 #1005589 (1042 connections now open)</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">2020-10-22T12:28:10.853+0800 I  COMMAND  [conn1004028] command expMonitordb.$cmd command: profile { profile: -1, $clusterTime: { clusterTime: Timestamp(1603340599, 25), signature: { hash: BinData(0, A6629B4A02DAC651DF672778E73312F2EA74749E), keyId: 6844800181754396704 } }, $db: \"expMonitordb\", $readPreference: { mode: \"primaryPreferred\" } } numYields:0 reslen:354 locks:{ ParallelBatchWriterMode: { acquireCount: { r: 1 } }, ReplicationStateTransition: { acquireCount: { w: 1 } }, Global: { acquireCount: { r: 1 } }, Database: { acquireCount: { R: 1 }, acquireWaitCount: { R: 1 }, timeAcquiringMicros: { R: 291292837 } }, Mutex: { acquireCount: { r: 1 } } } protocol:op_msg 291293ms\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n<p>so i need to set profilelevel=0,so this command does not get current settings? <br/>\n how to disable this command?</p>\n\n<p> </p>\n\n<p>4、mongod db profileStatus:</p>\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">shard1:PRIMARY&gt; db.getProfilingStatus();{ \"was\" : 1, \"slowms\" : 100, \"sampleRate\" : 1, \"$gleStats\" : { \"lastOpTime\" : Timestamp(0, 0), \"electionId\" : ObjectId(\"7fffffff0000000000000005\") }, \"lastCommittedOpTime\" : Timestamp(1605863816, 6506), \"$configServerState\" : { \"opTime\" : { \"ts\" : Timestamp(1605863815, 5381), \"t\" : NumberLong(1) } }, \"$clusterTime\" : { \"clusterTime\" : Timestamp(1605863816, 6539), \"signature\" : { \"hash\" : BinData(0,\"ztX6+flrG6FrQXVENsfn3tg39mM=\"), \"keyId\" : NumberLong(\"6844800181754396704\") } }, \"operationTime\" : Timestamp(1605863816, 6539)}</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n<p> </p>"
        },
        {
          "id": "3503221",
          "author": "601290552@qq.com",
          "created": "Tue, 24 Nov 2020 07:11:42 +0000",
          "content": "<p>The key insertion phase of a hybrid index build seems to hold and not yield an IX (w) lock. Any single command with an S (R) lock can block all operations during that time. In this case the offending command seems to be the read-only profile command (<tt>profile: -1</tt>)</p>\n\n<p> </p>\n\n<p>mongodb  key insertion is write operation,so it holds IX(w) lock, so it block S lock, it is ok.</p>\n\n<p> </p>\n\n<p>profile: -1 is it hold IS(r) lock. rather than hold  S (R) lock</p>\n\n<p> </p>"
        },
        {
          "id": "3653376",
          "author": "JIRAUSER1257149",
          "created": "Mon, 8 Mar 2021 23:01:14 +0000",
          "content": "<p>Can anyone confirm if this same bug exists in v4.4?</p>"
        },
        {
          "id": "3653405",
          "author": "louis.williams",
          "created": "Mon, 8 Mar 2021 23:15:53 +0000",
          "content": "<p><a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=amanda.brosig\" class=\"user-hover\" rel=\"amanda.brosig\">Amanda Brosig</a>, this affects all versions of 4.2 and 4.4.</p>"
        },
        {
          "id": "3885501",
          "author": "louis.williams",
          "created": "Thu, 17 Jun 2021 18:02:32 +0000",
          "content": "<p>There will be a workaround available for this issue available in the next 4.4 release that prevents the profile operation from blocking index builds. See <a href=\"https://jira.mongodb.org/browse/SERVER-55034\" title=\"The profile command should not take S or X database locks\" class=\"issue-link\" data-issue-key=\"SERVER-55034\"><del>SERVER-55034</del></a> for details.</p>"
        },
        {
          "id": "3982135",
          "author": "xgen-internal-githook",
          "created": "Thu, 5 Aug 2021 02:50:06 +0000",
          "content": "<p>Author:</p>\n{'name': 'Yuhong Zhang', 'email': 'danielzhangyh@gmail.com', 'username': 'YuhongZhang98'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-51806\" title=\"bulk key insertion phase of index build holds IX lock without yielding\" class=\"issue-link\" data-issue-key=\"SERVER-51806\"><del>SERVER-51806</del></a> bulk key insertion phase of index build holds IX lock without yielding<br/>\nBranch: master<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/935bd194b9ff3cd871470d2e6fe036ee288f17f2\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/935bd194b9ff3cd871470d2e6fe036ee288f17f2</a></p>"
        },
        {
          "id": "4075880",
          "author": "xgen-internal-githook",
          "created": "Tue, 21 Sep 2021 21:46:32 +0000",
          "content": "<p>Author:</p>\n{'name': 'Yuhong Zhang', 'email': 'danielzhangyh@gmail.com', 'username': 'YuhongZhang98'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-51806\" title=\"bulk key insertion phase of index build holds IX lock without yielding\" class=\"issue-link\" data-issue-key=\"SERVER-51806\"><del>SERVER-51806</del></a> bulk key insertion phase of index build holds IX lock without yielding</p>\n\n<p>(cherry picked from commit 935bd194b9ff3cd871470d2e6fe036ee288f17f2)<br/>\nBranch: v5.0<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/60faa8ed58c6b86e4e5bf5d3de4d2b4638f483f8\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/60faa8ed58c6b86e4e5bf5d3de4d2b4638f483f8</a></p>"
        }
      ]
    },
    "issuelinks": {
      "issuelinktype": [
        {
          "id": "10420",
          "name": "Backports",
          "outwardlinks": {
            "description": "backported by"
          },
          "inwardlinks": {
            "description": "backports"
          }
        },
        {
          "id": "10520",
          "name": "Problem/Incident",
          "outwardlinks": {
            "description": "causes"
          }
        },
        {
          "id": "10012",
          "name": "Related",
          "inwardlinks": {
            "description": "is related to",
            "issuelink": [
              {
                "issuekey": {
                  "id": "1845835",
                  "content": "SERVER-59190"
                }
              },
              {
                "issuekey": {
                  "id": "1839084",
                  "content": "SERVER-59042"
                }
              },
              {
                "issuekey": {
                  "id": "1557106",
                  "content": "SERVER-53180"
                }
              },
              {
                "issuekey": {
                  "id": "1643268",
                  "content": "SERVER-55034"
                }
              }
            ]
          }
        }
      ]
    },
    "attachments": {
      "attachment": [
        {
          "id": "284435",
          "name": "Screen Shot 2020-10-26 at 10.01.53 AM.png",
          "size": "97659",
          "author": "eric.sedor",
          "created": "Mon, 26 Oct 2020 17:04:07 +0000"
        },
        {
          "id": "285608",
          "name": "Screen Shot 2020-11-03 at 2.27.31 PM.png",
          "size": "96165",
          "author": "eric.sedor",
          "created": "Tue, 3 Nov 2020 22:27:48 +0000"
        },
        {
          "id": "302020",
          "name": "Screen Shot 2021-02-26 at 14.53.11.png",
          "size": "100117",
          "author": "jennifer.huang",
          "created": "Fri, 26 Feb 2021 14:55:00 +0000"
        },
        {
          "id": "306816",
          "name": "Screen Shot 2021-03-26 at 18.25.10.png",
          "size": "61013",
          "author": "jennifer.huang",
          "created": "Fri, 26 Mar 2021 18:25:21 +0000"
        },
        {
          "id": "284029",
          "name": "metrics.2020-10-21T19-47-05Z-00000",
          "size": "10410467",
          "author": "601290552@qq.com",
          "created": "Thu, 22 Oct 2020 12:58:55 +0000"
        },
        {
          "id": "284024",
          "name": "metrics.2020-10-22T00-17-05Z-00000",
          "size": "10489382",
          "author": "601290552@qq.com",
          "created": "Thu, 22 Oct 2020 12:47:51 +0000"
        },
        {
          "id": "284025",
          "name": "metrics.2020-10-22T04-31-37Z-00000",
          "size": "10472702",
          "author": "601290552@qq.com",
          "created": "Thu, 22 Oct 2020 12:49:08 +0000"
        },
        {
          "id": "284026",
          "name": "metrics.2020-10-22T08-31-42Z-00000",
          "size": "10336305",
          "author": "601290552@qq.com",
          "created": "Thu, 22 Oct 2020 12:52:00 +0000"
        },
        {
          "id": "284028",
          "name": "metrics.2020-10-22T12-31-43Z-00000",
          "size": "1084470",
          "author": "601290552@qq.com",
          "created": "Thu, 22 Oct 2020 12:58:07 +0000"
        },
        {
          "id": "284027",
          "name": "shard1.log.tar.gz",
          "size": "46298866",
          "author": "601290552@qq.com",
          "created": "Thu, 22 Oct 2020 12:52:52 +0000"
        }
      ]
    },
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "19.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "2.0"
          }
        },
        {
          "id": "customfield_12450",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes",
          "customfieldname": "Backport Requested",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "key": "21777",
                "content": "v5.0"
              },
              {
                "key": "18953",
                "content": "v4.4"
              },
              {
                "key": "16775",
                "content": "v4.2"
              }
            ]
          }
        },
        {
          "id": "customfield_10011",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Backwards Compatibility",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10038",
              "content": "Fully Compatible"
            }
          }
        },
        {
          "id": "customfield_13552",
          "key": "com.go2group.jira.plugin.crm:crm_generic_field",
          "customfieldname": "Case",
          "customfieldvalues": {
            "customfieldvalue": "[5002K00000tTREeQAO, 5002K00000tR8IwQAK, 5002K00000xmcgiQAA]"
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Mon, 26 Oct 2020 23:07:14 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        2 days ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_17050",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Downstream Team Attention",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "16941",
              "content": "Not Needed"
            }
          }
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "dmitry.ryabtsev"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            2 days ago\n                        "
        },
        {
          "id": "customfield_16465",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Linked BF Score",
          "customfieldvalues": {
            "customfieldvalue": "137.0"
          }
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "amanda.brosig",
              "eric.sedor",
              "xgen-internal-githook",
              "601290552@qq.com",
              "louis.williams",
              "yuhong.zhang"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hye0yv:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "0|i00l8f:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "id": "4882",
                "content": "Execution Team 2021-07-26"
              },
              {
                "id": "5116",
                "content": "Execution Team 2021-08-09"
              }
            ]
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hydn87:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-53853] Large buildup of mongos to mongod connections and low performance with secondaryPreferred reads",
    "link": "https://jira.mongodb.org/browse/SERVER-53853",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>Test consists of 500 threads doing secondaryPreferred reads as fast as possible against a single shard cluster. In the chart below the queries before A are from the primary for reference, after A are secondaryPreferred.</p>\n\n<p><span class=\"image-wrap\" style=\"\"><img src=\"https://jira.mongodb.org/secure/attachment/295769/295769_conns.png\" width=\"100%\" style=\"border: 0px solid black\" /></span></p>\n\n<ul>\n\t<li>As expected, there are 500 connections to mongos, so there are as many as 500 outstanding operations.</li>\n</ul>\n\n\n<ul>\n\t<li>Before A when reading from the primary (node 0) connections from mongos to mongod build to about 300, and the pool totalInUse and mongod active connections metrics are at times in the hundreds, justifying the need for 300 connections.</li>\n</ul>\n\n\n<ul>\n\t<li>But after A when doing secondary reads connections from mongos to mongod build steadily up to about 10 k connections, far more than the 500 possible outstanding operations. Most of those are considered \"in use\" by mongos, but very few are \"active\" in mongod.</li>\n</ul>\n\n\n<ul>\n\t<li>After reaching about 10 k connections the mongos seems to reset and begin building connections again, either to the same or a different secondary.</li>\n</ul>\n\n\n<ul>\n\t<li>Slow query logs from mongos record a large number of operations taking tens of milliseconds, but almost non on mongod. The latency metrics from mongod confirm that there is no performance bottleneck on mongod.</li>\n</ul>\n\n\n<ul>\n\t<li>Query throughput after A when doing secondary reads is much less than the primary reads before A. This seems to get worse as the number of connections build, but the latency on mongod remains low, so this is probably not due to an issue on mongod with the number of connections, but rather some issue in mongos.</li>\n</ul>\n\n",
    "environment": "",
    "key": {
      "id": "1592884",
      "content": "SERVER-53853"
    },
    "summary": "Large buildup of mongos to mongod connections and low performance with secondaryPreferred reads",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "9",
      "content": "Done"
    },
    "assignee": {
      "username": "amirsaman.memaripour",
      "content": "Amirsaman Memaripour"
    },
    "reporter": {
      "username": "bruce.lucas",
      "content": "Bruce Lucas"
    },
    "labels": "",
    "created": "Sat, 16 Jan 2021 16:46:21 +0000",
    "updated": "Fri, 23 Apr 2021 20:28:06 +0000",
    "resolved": "Fri, 23 Apr 2021 20:28:06 +0000",
    "version": [

    ],
    "votes": "2",
    "watches": "30",
    "comments": {
      "comment": [
        {
          "id": "3569170",
          "author": "bruce.lucas@10gen.com",
          "created": "Sun, 17 Jan 2021 13:55:25 +0000",
          "content": "<p>While doing some more experiments I found that this issue does not always occur - sometimes the secondary reads are evenly distributed between the secondaries and no buildup of connections occurs. I guess this is the expected behavior? However it seemed to reproduce reliably when running the above (both mongo client and single-shard cluster) all on a single desktop machine with 24 cpus.</p>\n\n<p>Also noticed the following:</p>\n\n<p><span class=\"image-wrap\" style=\"\"><img src=\"https://jira.mongodb.org/secure/attachment/295805/295805_odd.png\" width=\"100%\" style=\"border: 0px solid black\" /></span></p>\n\n<p>During the period A-B for example</p>\n<ul>\n\t<li>As noted previously all queries are routed to secondary member 1, and a buildup of connections occurs on that node (although as mentioned above these connections were marked in-use on mongos but were not active on mongod, and there's no reason for 10 k connections to service at most 500 concurrent requests).</li>\n\t<li>No connections are created to secondary member 2 nor are queries routed there, but nevertheless there is a high volume of ismaster commands on member 2, about one per query, which seems unusual to me.</li>\n</ul>\n"
        },
        {
          "id": "3570846",
          "author": "bruce.lucas@10gen.com",
          "created": "Tue, 19 Jan 2021 13:50:05 +0000",
          "content": "<p>This issue affects 4.2.0 and 4.2.11, but does not seem to affect 4.0.22 nor 4.4.3.</p>"
        },
        {
          "id": "3573544",
          "author": "bruce.lucas@10gen.com",
          "created": "Wed, 20 Jan 2021 15:23:46 +0000",
          "content": "<p>There's another report in <a href=\"https://jira.mongodb.org/browse/SERVER-53899\" title=\"TaskExecutor CPU fills up instantly\" class=\"issue-link\" data-issue-key=\"SERVER-53899\"><del>SERVER-53899</del></a> that may be impacted by this issue.</p>"
        },
        {
          "id": "3736619",
          "author": "JIRAUSER1254107",
          "created": "Fri, 23 Apr 2021 20:27:28 +0000",
          "content": "<p>We believe this issue was addressed with <a href=\"https://jira.mongodb.org/browse/SERVER-54278\" class=\"external-link\" rel=\"nofollow\">https://jira.mongodb.org/browse/SERVER-54278</a>. Thanks everyone! </p>"
        }
      ]
    },
    "issuelinks": {
      "issuelinktype": [
        {
          "id": "10010",
          "name": "Duplicate",
          "inwardlinks": {
            "description": "is duplicated by",
            "issuelink": {
              "issuekey": {
                "id": "1594651",
                "content": "SERVER-53899"
              }
            }
          }
        },
        {
          "id": "10012",
          "name": "Related",
          "outwardlinks": {
            "description": "related to",
            "issuelink": {
              "issuekey": {
                "id": "1611402",
                "content": "SERVER-54278"
              }
            }
          },
          "inwardlinks": {
            "description": "is related to"
          }
        }
      ]
    },
    "attachments": {
      "attachment": [
        {
          "id": "296402",
          "name": "connection-pool.png",
          "size": "230303",
          "author": "amirsaman.memaripour",
          "created": "Thu, 21 Jan 2021 02:09:12 +0000"
        },
        {
          "id": "296398",
          "name": "connections.png",
          "size": "344176",
          "author": "amirsaman.memaripour",
          "created": "Thu, 21 Jan 2021 01:48:39 +0000"
        },
        {
          "id": "295769",
          "name": "conns.png",
          "size": "272629",
          "author": "bruce.lucas",
          "created": "Sat, 16 Jan 2021 16:45:37 +0000"
        },
        {
          "id": "297430",
          "name": "default-scheduling.png",
          "size": "251095",
          "author": "amirsaman.memaripour",
          "created": "Wed, 27 Jan 2021 22:57:25 +0000"
        },
        {
          "id": "296395",
          "name": "mongos-targeting.png",
          "size": "197155",
          "author": "amirsaman.memaripour",
          "created": "Thu, 21 Jan 2021 01:30:11 +0000"
        },
        {
          "id": "295805",
          "name": "odd.png",
          "size": "369241",
          "author": "bruce.lucas",
          "created": "Sun, 17 Jan 2021 13:45:24 +0000"
        },
        {
          "id": "297431",
          "name": "reactor-scheduling.png",
          "size": "232094",
          "author": "amirsaman.memaripour",
          "created": "Wed, 27 Jan 2021 22:57:39 +0000"
        },
        {
          "id": "296966",
          "name": "single-target-command.png",
          "size": "378671",
          "author": "amirsaman.memaripour",
          "created": "Mon, 25 Jan 2021 22:04:35 +0000"
        },
        {
          "id": "295770",
          "name": "x-conns.tgz",
          "size": "1355104",
          "author": "bruce.lucas",
          "created": "Sat, 16 Jan 2021 16:50:25 +0000"
        }
      ]
    },
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "4.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "7.0"
          }
        },
        {
          "id": "customfield_13552",
          "key": "com.go2group.jira.plugin.crm:crm_generic_field",
          "customfieldname": "Case",
          "customfieldvalues": {
            "customfieldvalue": "[5002K00000s0IVRQA2]"
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Mon, 18 Jan 2021 22:48:16 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        21 weeks, 6 days ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "matthew.tretin"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            21 weeks, 6 days ago\n                        "
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "amirsaman.memaripour",
              "bruce.lucas",
              "matthew.tretin"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hypzx3:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hys0jz:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "id": "4500",
                "content": "Service Arch 2021-02-08"
              },
              {
                "id": "4501",
                "content": "Service Arch 2021-02-22"
              },
              {
                "id": "4502",
                "content": "Service Arch 2021-03-08"
              },
              {
                "id": "4503",
                "content": "Service Arch 2021-03-22"
              },
              {
                "id": "4504",
                "content": "Service Arch 2021-04-05"
              },
              {
                "id": "4685",
                "content": "Service Arch 2021-04-19"
              },
              {
                "id": "4686",
                "content": "Service Arch 2021-05-03"
              }
            ]
          }
        },
        {
          "id": "customfield_10750",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:textarea",
          "customfieldname": "Steps To Reproduce",
          "customfieldvalues": {
            "customfieldvalue": "<p>Run this workload against a single-shard cluster</p>\n\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">function repro() {</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\">&nbsp;</pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">    nthreads = 500</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">    db.c.insert({_id: 0})</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\">&nbsp;</pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">    threads = []</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">    for (var t=0; t&lt;nthreads; t++) {</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">        thread = new Thread(function(t) {</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">            while (true)</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">                db.c.find({_id: 0}).readPref(\"secondaryPreferred\").itcount()</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">        }, t)</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">        threads.push(thread)</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">        thread.start()</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">    }</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">    for (var t = 0; t &lt; nthreads; t++)</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">        threads[t].join()</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\">&nbsp;</pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">}\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>"
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hypm6f:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-53973] Migration manager recovery should handle failed findIntersectingChunk during refineShardKey",
    "link": "https://jira.mongodb.org/browse/SERVER-53973",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>The call to <a href=\"https://github.com/mongodb/mongo/blob/ee1e7ff4575e1b5b7d5957feef60206f80dc22cc/src/mongo/db/s/balancer/migration_manager.cpp#L351\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">findIntersectingChunkWithSimpleCollation</a> is being called with the original shard key after a refineShardKey operation. This results in a ShardKeyNotFound exception being thrown which goes unhandled.</p>\n\n<p>This should have been addressed by the changes in <a href=\"https://jira.mongodb.org/browse/SERVER-48365\" class=\"external-link\" rel=\"nofollow\">https://jira.mongodb.org/browse/SERVER-48365</a> by making sure that the migration recovery entries are written while holding the dist lock. However, there is an interleaving where this is not the case.</p>",
    "environment": "",
    "key": {
      "id": "1597708",
      "content": "SERVER-53973"
    },
    "summary": "Migration manager recovery should handle failed findIntersectingChunk during refineShardKey",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "1",
      "content": "Fixed"
    },
    "assignee": {
      "username": "tommaso.tocci",
      "content": "Tommaso Tocci"
    },
    "reporter": {
      "username": "alex.taskov",
      "content": "Alexander Taskov"
    },
    "labels": {
      "label": [
        "Sharding-EMEA",
        "sharding-wfbf-day"
      ]
    },
    "created": "Fri, 22 Jan 2021 15:38:25 +0000",
    "updated": "Tue, 25 May 2021 22:12:11 +0000",
    "resolved": "Tue, 30 Mar 2021 09:56:13 +0000",
    "version": "",
    "fixVersion": [
      "4.4.6",
      "5.0.0-rc0"
    ],
    "component": "Sharding",
    "votes": "0",
    "watches": "4",
    "comments": {
      "comment": [
        {
          "id": "3646441",
          "author": "tommaso.tocci",
          "created": "Thu, 4 Mar 2021 12:27:42 +0000",
          "content": "<p>I'll bounce back this to <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=alex.taskov\" class=\"user-hover\" rel=\"alex.taskov\">Alexander Taskov</a> to add more context.</p>"
        },
        {
          "id": "3653818",
          "author": "kaloian.manassiev",
          "created": "Tue, 9 Mar 2021 07:33:07 +0000",
          "content": "<p>I think the problem is just that the following race condition can happen:</p>\n<ol>\n\t<li>A migration starts, which <a href=\"https://github.com/mongodb/mongo/blob/d0004a3e0239570a2602af35f14a84a47fb290b1/src/mongo/db/s/balancer/migration_manager.cpp#L523\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">takes the dist lock</a>, then <a href=\"https://github.com/mongodb/mongo/blob/d0004a3e0239570a2602af35f14a84a47fb290b1/src/mongo/db/s/balancer/migration_manager.cpp#L547\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">writes</a> document with shardKey {a: 1}, which majority commits (so there is actually no order issue)</li>\n\t<li>Step-down happens of that same node, followed by step-up, but on the config server we <a href=\"https://github.com/mongodb/mongo/blob/8f5b19480757929c98a5d7675c4c1762b32b09e9/src/mongo/db/repl/replication_coordinator_external_state_impl.cpp#L864\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">throw-out the dist locks</a> unconditionally</li>\n\t<li>Before the Balancer recovery has managed to run and re-acquire the dist locks, a refine shard key sneaks-in</li>\n\t<li>Now the Balancer recovery has a wrong shard key</li>\n</ol>\n\n\n<p> </p>\n\n<p>I think it will be extremely difficult to fix the distributed lock unlocking issue, so instead we should just address the crash by try/catching the lookup of the chunk in the ChunkManager and abandoning that migration recovery in that case.</p>"
        },
        {
          "id": "3687614",
          "author": "tommaso.tocci",
          "created": "Sat, 27 Mar 2021 12:41:58 +0000",
          "content": "<p><a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=kaloian.manassiev\" class=\"user-hover\" rel=\"kaloian.manassiev\">Kaloian Manassiev</a> was right about the racing scenario, I've been able to reproduce it by adding a couple of sleeps. <a href=\"https://github.com/toto-dev/mongo/commit/0a000591ab8cb883331efcb975fd19cf1a71ab41\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">This is patch to reproduce the error</a></p>"
        },
        {
          "id": "3690717",
          "author": "xgen-internal-githook",
          "created": "Tue, 30 Mar 2021 09:50:57 +0000",
          "content": "<p>Author:</p>\n{'name': 'Tommaso Tocci', 'email': 'tommaso.tocci@mongodb.com', 'username': 'toto-dev'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-53973\" title=\"Migration manager recovery should handle failed findIntersectingChunk during refineShardKey\" class=\"issue-link\" data-issue-key=\"SERVER-53973\"><del>SERVER-53973</del></a> Migration manager recovery should handle failed findIntersectingChunk during refineShardKey<br/>\nBranch: master<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/1256d8e67a6b4bb88875cbc112987bbc8fffe76b\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/1256d8e67a6b4bb88875cbc112987bbc8fffe76b</a></p>"
        },
        {
          "id": "3706643",
          "author": "xgen-internal-githook",
          "created": "Wed, 7 Apr 2021 21:36:59 +0000",
          "content": "<p>Author:</p>\n{'name': 'Tommaso Tocci', 'email': 'tommaso.tocci@mongodb.com', 'username': 'toto-dev'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-53973\" title=\"Migration manager recovery should handle failed findIntersectingChunk during refineShardKey\" class=\"issue-link\" data-issue-key=\"SERVER-53973\"><del>SERVER-53973</del></a> Migration manager recovery should handle failed findIntersectingChunk during refineShardKey<br/>\nBranch: v4.4<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/469b1101cea8cf0c5b34437cdeb391b7002f7d19\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/469b1101cea8cf0c5b34437cdeb391b7002f7d19</a></p>"
        }
      ]
    },
    "issuelinks": {
      "issuelinktype": [
        {
          "id": "10420",
          "name": "Backports",
          "outwardlinks": {
            "description": "backported by"
          }
        },
        {
          "id": "10011",
          "name": "Depends",
          "inwardlinks": {
            "description": "is depended on by"
          }
        }
      ]
    },
    "attachments": "",
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "5.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "4.0"
          }
        },
        {
          "id": "customfield_12450",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes",
          "customfieldname": "Backport Requested",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "18953",
              "content": "v4.4"
            }
          }
        },
        {
          "id": "customfield_10011",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Backwards Compatibility",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10038",
              "content": "Fully Compatible"
            }
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Fri, 29 Jan 2021 16:13:12 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        24 weeks, 1 day ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_17050",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Downstream Team Attention",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "16941",
              "content": "Not Needed"
            }
          }
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "vivian.ge"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            24 weeks, 1 day ago\n                        "
        },
        {
          "id": "customfield_16465",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Linked BF Score",
          "customfieldvalues": {
            "customfieldvalue": "26.0"
          }
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "alex.taskov",
              "xgen-internal-githook",
              "kaloian.manassiev",
              "tommaso.tocci"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyqtgf:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyt5db:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "id": "4485",
                "content": "Sharding 2021-02-22"
              },
              {
                "id": "4486",
                "content": "Sharding 2021-03-08"
              },
              {
                "id": "4487",
                "content": "Sharding 2021-03-22"
              },
              {
                "id": "4497",
                "content": "Sharding 2021-04-05"
              }
            ]
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyqfpj:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-54507] Can't execute $merge if sharding catalog cache is empty",
    "link": "https://jira.mongodb.org/browse/SERVER-54507",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>Manifestation of the bug: <b>The impossibility to execute the $merge pipeline stage</b></p>\n\n\n<p>Consider the case in which the $merge pipeline stage is executed in a shard that:</p>\n<ul>\n\t<li>Has the CollectionShardingState correctly updated with the latest shard version of the target collection.</li>\n\t<li>Doesn't currently hold any entry in the cache for the target collection.</li>\n</ul>\n\n\n<p>(This is possible because the sharding catalog cache is a LRU cache in which not frequently used entries can be evicted.)</p>\n\n<p>The shard executes <a href=\"https://github.com/mongodb/mongo/blob/399ce1d4f498b815290cd0f16c881e0e22ebeda8/src/mongo/db/pipeline/document_source_merge.cpp#L444\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">DocumentSourceMerge::createFromBson() </a>that triggers a call to <a href=\"https://github.com/mongodb/mongo/blob/399ce1d4f498b815290cd0f16c881e0e22ebeda8/src/mongo/db/pipeline/document_source_merge.cpp#L458\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">MongoProcessInterface::ensureFieldsUniqueOrResolveDocumentKey()</a>.  This function in the end <a href=\"https://github.com/mongodb/mongo/blob/3afb4b31149e5a747e25f2aab611621a99bf8667/src/mongo/s/catalog_cache.cpp#L326-L330\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">throws a StaleConfigInfo</a> because the target collection is not present in the cache. The error is correctly handled by the shard that will execute the <a href=\"https://github.com/mongodb/mongo/blob/3afb4b31149e5a747e25f2aab611621a99bf8667/src/mongo/db/s/shard_filtering_metadata_refresh.h#L41-L62\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">onShardVersionMismatch()</a> procedure.</p>\n\n<p>Since the CollectionShardingState already contains the latest shard version for the target collection no action will be taken and no refresh of the catalog cache will be triggered.</p>\n\n<p>In other words if the CollectionShardingState is up to date, the StaleConfigInfo won't guarantee that the catalog cache will be refreshed.</p>",
    "environment": "",
    "key": {
      "id": "1622704",
      "content": "SERVER-54507"
    },
    "summary": "Can't execute $merge if sharding catalog cache is empty",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "1",
      "content": "Fixed"
    },
    "assignee": {
      "username": "eric.cox",
      "content": "Eric Cox"
    },
    "reporter": {
      "username": "tommaso.tocci",
      "content": "Tommaso Tocci"
    },
    "labels": "",
    "created": "Fri, 12 Feb 2021 18:01:08 +0000",
    "updated": "Thu, 1 Jul 2021 17:16:00 +0000",
    "resolved": "Fri, 7 May 2021 22:08:12 +0000",
    "version": "",
    "fixVersion": "5.0.0-rc0",
    "component": "Querying",
    "votes": "0",
    "watches": "7",
    "comments": {
      "comment": [
        {
          "id": "3762196",
          "author": "xgen-internal-githook",
          "created": "Fri, 7 May 2021 21:53:13 +0000",
          "content": "<p>Author:</p>\n{'name': 'Eric Cox', 'email': 'eric.cox@mongodb.com', 'username': 'ericox'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-54507\" title=\"Can&#39;t execute $merge if sharding catalog cache is empty\" class=\"issue-link\" data-issue-key=\"SERVER-54507\"><del>SERVER-54507</del></a> Can't execute merge if sharding catalog cache is empty<br/>\nBranch: master<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/32fe49396dec58836033bca67ad1360b1a80f03c\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/32fe49396dec58836033bca67ad1360b1a80f03c</a></p>"
        },
        {
          "id": "3912734",
          "author": "xgen-internal-githook",
          "created": "Thu, 1 Jul 2021 17:16:00 +0000",
          "content": "<p>Author:</p>\n{'name': 'Eric Cox', 'email': 'eric.cox@mongodb.com', 'username': 'ericox'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-56815\" title=\"Complete TODO listed in SERVER-54507\" class=\"issue-link\" data-issue-key=\"SERVER-56815\"><del>SERVER-56815</del></a> Complete TODO listed in <a href=\"https://jira.mongodb.org/browse/SERVER-54507\" title=\"Can&#39;t execute $merge if sharding catalog cache is empty\" class=\"issue-link\" data-issue-key=\"SERVER-54507\"><del>SERVER-54507</del></a><br/>\nBranch: master<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/620a4c060e7cf06d340a81b01cad62f5812852f3\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/620a4c060e7cf06d340a81b01cad62f5812852f3</a></p>"
        }
      ]
    },
    "issuelinks": {
      "issuelinktype": [
        {
          "id": "10420",
          "name": "Backports",
          "outwardlinks": {
            "description": "backported by"
          }
        },
        {
          "id": "10011",
          "name": "Depends",
          "inwardlinks": {
            "description": "is depended on by"
          }
        },
        {
          "id": "10520",
          "name": "Problem/Incident",
          "outwardlinks": {
            "description": "causes"
          }
        },
        {
          "id": "10012",
          "name": "Related",
          "outwardlinks": {
            "description": "related to",
            "issuelink": {
              "issuekey": {
                "id": "1709023",
                "content": "SERVER-56815"
              }
            }
          },
          "inwardlinks": {
            "description": "is related to",
            "issuelink": {
              "issuekey": {
                "id": "1706905",
                "content": "SERVER-56763"
              }
            }
          }
        }
      ]
    },
    "attachments": {
      "attachment": {
        "id": "299993",
        "name": "merge_cache_bug.patch",
        "size": "877",
        "author": "tommaso.tocci",
        "created": "Fri, 12 Feb 2021 17:59:04 +0000"
      }
    },
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "2.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "6.0"
          }
        },
        {
          "id": "customfield_12450",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes",
          "customfieldname": "Backport Requested",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "key": "21266",
                "content": "v4.9"
              },
              {
                "key": "18953",
                "content": "v4.4"
              },
              {
                "key": "16775",
                "content": "v4.2"
              },
              {
                "key": "15640",
                "content": "v4.0"
              }
            ]
          }
        },
        {
          "id": "customfield_10011",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Backwards Compatibility",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10038",
              "content": "Fully Compatible"
            }
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Thu, 18 Feb 2021 17:21:46 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        12 weeks ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_17050",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Downstream Team Attention",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "16941",
              "content": "Not Needed"
            }
          }
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "xgen-internal-githook"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            12 weeks ago\n                        "
        },
        {
          "id": "customfield_16465",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Linked BF Score",
          "customfieldvalues": {
            "customfieldvalue": "145.0"
          }
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "eric.cox",
              "xgen-internal-githook",
              "tommaso.tocci"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyv0lj:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hywtsf:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "id": "4464",
                "content": "Query Execution 2021-03-08"
              },
              {
                "id": "4466",
                "content": "Query Execution 2021-03-22"
              },
              {
                "id": "4468",
                "content": "Query Execution 2021-04-05"
              },
              {
                "id": "4470",
                "content": "Query Execution 2021-04-19"
              },
              {
                "id": "4472",
                "content": "Query Execution 2021-05-03"
              },
              {
                "id": "4697",
                "content": "Query Execution 2021-05-17"
              }
            ]
          }
        },
        {
          "id": "customfield_10750",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:textarea",
          "customfieldname": "Steps To Reproduce",
          "customfieldvalues": {
            "customfieldvalue": "<p>Even though it can be reproduced by a far more easy test case, I've been able to reproduce consistently this bug by just flushing the cache for the target collection in jstests/sharding/query/merge_write_concern.js before to execute the $merge aggregation command.</p>\n\n<p><span class=\"nobr\"><a href=\"https://jira.mongodb.org/secure/attachment/299993/299993_merge_cache_bug.patch\" title=\"merge_cache_bug.patch attached to SERVER-54507\">merge_cache_bug.patch<sup><img class=\"rendericon\" src=\"https://jira.mongodb.org/images/icons/link_attachment_7.gif\" height=\"7\" width=\"7\" align=\"absmiddle\" alt=\"\" border=\"0\"/></sup></a></span></p>"
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyumun:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-54701] shardCollection might succesfully write to the config server but end up with missing indexes on the primary Shard",
    "link": "https://jira.mongodb.org/browse/SERVER-54701",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>The <a href=\"https://github.com/mongodb/mongo/blob/3eb157099b6a405297bac39168712039751bac8e/src/mongo/db/s/shardsvr_shard_collection.cpp#L329\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">index creation on the shard collection path</a> is performed using a <a href=\"https://github.com/mongodb/mongo/blob/3eb157099b6a405297bac39168712039751bac8e/src/mongo/db/s/shard_key_util.cpp#L227\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">DBClient</a>, which does not wait for majority write concern. The following scenario might happen:</p>\n\n<p>1. The shard index is created locally<br/>\n2. The writes to config.chunks and config.collections are sent to the config server<br/>\n3. A stepdown happens<br/>\n4. The index creation is rolled backed</p>\n\n<p>If the write on step two succeeds then we'll end up with a sharded collection without the sharded index created on the primary. We should wait for majority write concern of the latest write after the index creation (probably using the same as the <a href=\"https://github.com/mongodb/mongo/blob/v4.4/src/mongo/db/s/config/sharding_catalog_manager_database_operations.cpp#L231\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">sharding catalog manager</a>)</p>",
    "environment": "",
    "key": {
      "id": "1629707",
      "content": "SERVER-54701"
    },
    "summary": "shardCollection might succesfully write to the config server but end up with missing indexes on the primary Shard",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "1",
      "content": "Fixed"
    },
    "assignee": {
      "username": "marcos.grillo",
      "content": "Marcos José Grillo Ramirez"
    },
    "reporter": {
      "username": "marcos.grillo",
      "content": "Marcos José Grillo Ramirez"
    },
    "labels": "",
    "created": "Mon, 22 Feb 2021 16:49:22 +0000",
    "updated": "Tue, 23 Mar 2021 13:29:02 +0000",
    "resolved": "Tue, 23 Mar 2021 13:29:01 +0000",
    "version": "",
    "fixVersion": "4.4.5",
    "component": "Sharding",
    "votes": "0",
    "watches": "1",
    "comments": {
      "comment": {
        "id": "3678955",
        "author": "xgen-internal-githook",
        "created": "Tue, 23 Mar 2021 13:22:18 +0000",
        "content": "<p>Author:</p>\n{'name': 'Marcos José Grillo Ramirez', 'email': 'marcos.grillo@mongodb.com', 'username': 'm4nti5'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-54701\" title=\"shardCollection might succesfully write to the config server but end up with missing indexes on the primary Shard\" class=\"issue-link\" data-issue-key=\"SERVER-54701\"><del>SERVER-54701</del></a> Wait for majority write concern after shard index creation<br/>\nBranch: v4.4<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/37b8886db6b9e1df473c1b6b90142641b73f87f9\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/37b8886db6b9e1df473c1b6b90142641b73f87f9</a></p>"
      }
    },
    "attachments": "",
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "1.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "2.0"
          }
        },
        {
          "id": "customfield_10011",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Backwards Compatibility",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10038",
              "content": "Fully Compatible"
            }
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Tue, 23 Mar 2021 13:22:18 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        26 weeks, 3 days ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_17050",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Downstream Team Attention",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "16941",
              "content": "Not Needed"
            }
          }
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "marcos.grillo"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            26 weeks, 3 days ago\n                        "
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "xgen-internal-githook",
              "marcos.grillo"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyw75r:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyxyif:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "id": "4487",
                "content": "Sharding 2021-03-22"
              },
              {
                "id": "4497",
                "content": "Sharding 2021-04-05"
              }
            ]
          }
        },
        {
          "id": "customfield_10750",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:textarea",
          "customfieldname": "Steps To Reproduce",
          "customfieldvalues": {
            "customfieldvalue": "<p>1. The shard index is created locally<br/>\n2. The writes to config.chunks and config.collections are sent to the config server<br/>\n3. A stepdown happens<br/>\n4. The index creation is rolled backed</p>"
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyvtev:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-54756] protocol error from windows connector",
    "link": "https://jira.mongodb.org/browse/SERVER-54756",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>when we try to connect from microsoft ODBC connector, the server shows this error:</p>\n\n<p> </p>\n\n<p>Error receiving request from client. Ending connection from remote\",\"attr\":{\"error\":</p>\n{\"code\":17,\"codeName\":\"ProtocolError\",\"errmsg\":\"Client sent an HTTP request over a native MongoDB connection\"}",
    "environment": "",
    "key": {
      "id": "1632277",
      "content": "SERVER-54756"
    },
    "summary": "protocol error from windows connector",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "4",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/minor.svg",
      "content": "Minor - P4"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "9",
      "content": "Done"
    },
    "assignee": {
      "username": "backlog-server-triage",
      "content": "Backlog - Triage Team"
    },
    "reporter": {
      "username": "kevin@mainstreetcomputing.com",
      "content": "Kevin Chugh"
    },
    "labels": "",
    "created": "Wed, 24 Feb 2021 16:09:45 +0000",
    "updated": "Thu, 24 Jun 2021 17:09:38 +0000",
    "resolved": "Thu, 24 Jun 2021 17:09:38 +0000",
    "version": "",
    "component": "Networking",
    "votes": "0",
    "watches": "2",
    "comments": {
      "comment": {
        "id": "3648024",
        "author": "thomas.schubert",
        "created": "Thu, 4 Mar 2021 21:51:36 +0000",
        "content": "<p>Hi <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=kevin%40mainstreetcomputing.com\" class=\"user-hover\" rel=\"kevin@mainstreetcomputing.com\">Kevin Chugh</a>,</p>\n\n<p>Have you reviewed/followed the documentation on <a href=\"https://docs.mongodb.com/bi-connector/master/tutorial/create-system-dsn/?\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://docs.mongodb.com/bi-connector/master/tutorial/create-system-dsn/?</a></p>\n\n<p>Thanks,<br/>\nKelsey</p>"
      }
    },
    "attachments": "",
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "1.0"
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Thu, 4 Mar 2021 21:51:36 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        29 weeks ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "kelsey.schubert"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            29 weeks ago\n                        "
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "backlog-server-triage",
              "kelsey.schubert",
              "kevin@mainstreetcomputing.com"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hywmy7:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyyckf:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10750",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:textarea",
          "customfieldname": "Steps To Reproduce",
          "customfieldvalues": {
            "customfieldvalue": "<p>in windows, open odbc connections, configure server connection, click test, on the server side, the server accepts the connection then closes the connection</p>"
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyw97b:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-54803] StreamableReplicaSetMonitor registers a new topology listener per call to getHostsOrRefresh",
    "link": "https://jira.mongodb.org/browse/SERVER-54803",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>Whenever <a href=\"https://github.com/mongodb/mongo/blob/913d6b62acfbb344dde1b116f4161360acd8fd13/src/mongo/client/streamable_replica_set_monitor.cpp#L256\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">StreamableReplicaSetMonitor::getHostsOrRefresh</a> is called (which happens on every query), if the result isn't immediately available, we <a href=\"https://github.com/mongodb/mongo/blob/913d6b62acfbb344dde1b116f4161360acd8fd13/src/mongo/client/streamable_replica_set_monitor.cpp#L304\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">enqueue a query object</a> for that host, to be resolved <a href=\"https://github.com/mongodb/mongo/blob/913d6b62acfbb344dde1b116f4161360acd8fd13/src/mongo/client/streamable_replica_set_monitor.cpp#L744\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">when the host becomes available</a>. As part of enqueuing a query, we unconditionally <a href=\"https://github.com/mongodb/mongo/blob/913d6b62acfbb344dde1b116f4161360acd8fd13/src/mongo/client/streamable_replica_set_monitor.cpp#L358\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">register the query processor as an event listener</a> for topology changes. We only <a href=\"https://github.com/mongodb/mongo/blob/913d6b62acfbb344dde1b116f4161360acd8fd13/src/mongo/client/streamable_replica_set_monitor.cpp#L764-L766\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">remove that listener when all outstanding queries are satisfied</a>, but that won't happen as long as the node the RSM is targeting is down or unable to be contacted. <a href=\"https://github.com/mongodb/mongo/blob/913d6b62acfbb344dde1b116f4161360acd8fd13/src/mongo/client/sdam/topology_listener.cpp#L35\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">Registering a listener</a> does not do any deduplication to check whether the passed-in pointer is the same, which means the list of listeners will continue to grow as long as there are new queries. It also means that every time there's a topology change event, ALL of those listeners will then call requestImmediateCheck.</p>\n\n<p> </p>\n\n<p>We should change it so that the RSM _queryProcessor topology listener is only registered at most once.</p>",
    "environment": "",
    "key": {
      "id": "1634264",
      "content": "SERVER-54803"
    },
    "summary": "StreamableReplicaSetMonitor registers a new topology listener per call to getHostsOrRefresh",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "1",
      "content": "Fixed"
    },
    "assignee": {
      "username": "lamont.nelson",
      "content": "Lamont Nelson"
    },
    "reporter": {
      "username": "matthew.saltz",
      "content": "Matthew Saltz"
    },
    "labels": {
      "label": [
        "bkp",
        "sharding-wfbf-day"
      ]
    },
    "created": "Thu, 25 Feb 2021 21:06:25 +0000",
    "updated": "Fri, 11 Jun 2021 20:37:02 +0000",
    "resolved": "Tue, 8 Jun 2021 16:38:41 +0000",
    "version": "",
    "fixVersion": [
      "4.4.5",
      "5.1.0",
      "5.0.0-rc1"
    ],
    "component": "Networking",
    "votes": "0",
    "watches": "14",
    "comments": {
      "comment": [
        {
          "id": "3672242",
          "author": "xgen-internal-githook",
          "created": "Thu, 18 Mar 2021 20:54:38 +0000",
          "content": "<p>Author:</p>\n{'name': 'Matthew Saltz', 'email': 'matthew.saltz@mongodb.com', 'username': 'saltzm'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-54803\" title=\"StreamableReplicaSetMonitor registers a new topology listener per call to getHostsOrRefresh\" class=\"issue-link\" data-issue-key=\"SERVER-54803\"><del>SERVER-54803</del></a> Only register _queryProcessor once in StreamableRSM<br/>\nBranch: v4.4<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/80250fc73deb1d300473b8d2e9e98b5385da90c7\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/80250fc73deb1d300473b8d2e9e98b5385da90c7</a></p>"
        },
        {
          "id": "3672289",
          "author": "matthew.saltz",
          "created": "Thu, 18 Mar 2021 21:13:11 +0000",
          "content": "<p>Re-opening and opening a 4.4 Backport ticket, which I'll then immediately close since the commit went straight to the 4.4 branch</p>"
        },
        {
          "id": "3842092",
          "author": "lamont.nelson",
          "created": "Wed, 26 May 2021 16:26:26 +0000",
          "content": "<p>This shouldn't conflict with <a href=\"https://jira.mongodb.org/browse/SERVER-56854\" title=\"Provide the ability for RSM requests to timeout and mark the server as failed\" class=\"issue-link\" data-issue-key=\"SERVER-56854\"><del>SERVER-56854</del></a> since that is for the 4.0 &amp; 4.2 branches. It looks like this one just needs to be ported to 5.0 and master.</p>"
        },
        {
          "id": "3863479",
          "author": "xgen-internal-githook",
          "created": "Mon, 7 Jun 2021 20:12:09 +0000",
          "content": "<p>Author:</p>\n{'name': 'Matthew Saltz', 'email': 'matthew.saltz@mongodb.com', 'username': 'saltzm'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-54803\" title=\"StreamableReplicaSetMonitor registers a new topology listener per call to getHostsOrRefresh\" class=\"issue-link\" data-issue-key=\"SERVER-54803\"><del>SERVER-54803</del></a> Only register _queryProcessor once in StreamableRSM<br/>\nBranch: master<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/d6394bb39aae0ae99cfeeb9569203de2ff98e11a\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/d6394bb39aae0ae99cfeeb9569203de2ff98e11a</a></p>"
        },
        {
          "id": "3866529",
          "author": "xgen-internal-githook",
          "created": "Tue, 8 Jun 2021 15:51:45 +0000",
          "content": "<p>Author:</p>\n{'name': 'Matthew Saltz', 'email': 'matthew.saltz@mongodb.com', 'username': 'saltzm'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-54803\" title=\"StreamableReplicaSetMonitor registers a new topology listener per call to getHostsOrRefresh\" class=\"issue-link\" data-issue-key=\"SERVER-54803\"><del>SERVER-54803</del></a> Only register _queryProcessor once in StreamableRSM</p>\n\n<p>(cherry picked from commit d6394bb39aae0ae99cfeeb9569203de2ff98e11a)<br/>\nBranch: v5.0<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/2a98238a5a51521cd022a68ebfd79b5a39796b8d\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/2a98238a5a51521cd022a68ebfd79b5a39796b8d</a></p>"
        }
      ]
    },
    "issuelinks": {
      "issuelinktype": [
        {
          "id": "10420",
          "name": "Backports",
          "outwardlinks": {
            "description": "backported by"
          }
        },
        {
          "id": "10012",
          "name": "Related",
          "outwardlinks": {
            "description": "related to"
          }
        }
      ]
    },
    "attachments": "",
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "5.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "1.0"
          }
        },
        {
          "id": "customfield_12450",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes",
          "customfieldname": "Backport Requested",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "key": "21777",
                "content": "v5.0"
              },
              {
                "key": "18953",
                "content": "v4.4"
              }
            ]
          }
        },
        {
          "id": "customfield_10011",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Backwards Compatibility",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10038",
              "content": "Fully Compatible"
            }
          }
        },
        {
          "id": "customfield_13552",
          "key": "com.go2group.jira.plugin.crm:crm_generic_field",
          "customfieldname": "Case",
          "customfieldvalues": {
            "customfieldvalue": "[5002K00000sdBRgQAM, 5002K00000tUpqEQAS]"
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Thu, 18 Mar 2021 20:54:38 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        15 weeks, 2 days ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_17050",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Downstream Team Attention",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "16941",
              "content": "Not Needed"
            }
          }
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "steven.vannelli"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            15 weeks, 2 days ago\n                        "
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "xgen-internal-githook",
              "lamont.nelson",
              "matthew.saltz"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hywz3j:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hz0e6v:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": {
              "id": "4503",
              "content": "Service Arch 2021-03-22"
            }
          }
        },
        {
          "id": "customfield_10555",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:float",
          "customfieldname": "Story Points",
          "customfieldvalues": {
            "customfieldvalue": "4.0"
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hywlcn:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-54876] Upgrade mongodb 4.4.4 from 4.2.12 failed",
    "link": "https://jira.mongodb.org/browse/SERVER-54876",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>Hi,</p>\n\n<p>we've a replica set with 6 nodes mongodb e one arbiter.</p>\n\n<p>I  tried upgrade from 4.2.12 to 4.4.4 (rolling upgrade) and i did the following steps: </p>\n<ol>\n\t<li>Upgrade from 4.2.12 to 4.4.2 one secondary node and the node it works perfectly in secondary mode.</li>\n\t<li>switch primary from node 4.2.12 to 4.4.4 and the node 4.4.4 crashed.</li>\n</ol>\n\n\n<p>This is the output log trace before the node crash :</p>\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">{\"t\":\\{\"$date\":\"2021-03-02T08:08:19.684+00:00\"},\"s\":\"I\", \"c\":\"CONTROL\", \"id\":31431, \"ctx\":\"conn1407\",\"msg\":\"BACKTRACE: \\{bt}\",\"attr\":\\{\"bt\":{\"backtrace\":[{\"a\":\"559B86781BE1\",\"b\":\"559B83A79000\",\"o\":\"2D08BE1\",\"s\":\"_ZN5mongo18stack_trace_detail12_GLOBAL__N_119printStackTraceImplERKNS1_7OptionsEPNS_14StackTraceSinkE.constprop.606\",\"s+\":\"1E1\"},\\{\"a\":\"559B86783219\",\"b\":\"559B83A79000\",\"o\":\"2D0A219\",\"s\":\"_ZN5mongo15printStackTraceEv\",\"s+\":\"29\"},\\{\"a\":\"559B86780A76\",\"b\":\"559B83A79000\",\"o\":\"2D07A76\",\"s\":\"_ZN5mongo12_GLOBAL__N_116abruptQuitActionEiP9siginfo_tPv\",\"s+\":\"66\"},\\{\"a\":\"7F336A2F1630\",\"b\":\"7F336A2E2000\",\"o\":\"F630\",\"s\":\"_L_unlock_13\",\"s+\":\"34\"},\\{\"a\":\"7F3369F4A3D7\",\"b\":\"7F3369F14000\",\"o\":\"363D7\",\"s\":\"gsignal\",\"s+\":\"37\"},\\{\"a\":\"7F3369F4BAC8\",\"b\":\"7F3369F14000\",\"o\":\"37AC8\",\"s\":\"abort\",\"s+\":\"148\"},\\{\"a\":\"559B84993677\",\"b\":\"559B83A79000\",\"o\":\"F1A677\",\"s\":\"_ZN5mongo15invariantFailedEPKcS1_j\",\"s+\":\"12C\"},\\{\"a\":\"559B846E5560\",\"b\":\"559B83A79000\",\"o\":\"C6C560\",\"s\":\"_ZN5mongo4repl10MemberData35advanceLastDurableOpTimeAndWallTimeENS0_17OpTimeAndWallTimeENS_6Date_tE.cold.338\",\"s+\":\"18\"},\\{\"a\":\"559B84E097D3\",\"b\":\"559B83A79000\",\"o\":\"13907D3\",\"s\":\"_ZN5mongo4repl19TopologyCoordinator13setLastOptimeERKNS0_18UpdatePositionArgs10UpdateInfoENS_6Date_tEPx\",\"s+\":\"2E3\"},\\{\"a\":\"559B84D56C65\",\"b\":\"559B83A79000\",\"o\":\"12DDC65\",\"s\":\"_ZN5mongo4repl26ReplicationCoordinatorImpl14_setLastOptimeENS_8WithLockERKNS0_18UpdatePositionArgs10UpdateInfoEPx\",\"s+\":\"55\"},\\{\"a\":\"559B84D56DCF\",\"b\":\"559B83A79000\",\"o\":\"12DDDCF\",\"s\":\"_ZN5mongo4repl26ReplicationCoordinatorImpl28processReplSetUpdatePositionERKNS0_18UpdatePositionArgsEPx\",\"s+\":\"AF\"},\\{\"a\":\"559B84D11317\",\"b\":\"559B83A79000\",\"o\":\"1298317\",\"s\":\"_ZN5mongo4repl24CmdReplSetUpdatePosition3runEPNS_16OperationContextERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEERKNS_7BSONObjERNS_14BSONObjBuilderE\",\"s+\":\"167\"},\\{\"a\":\"559B856EC64A\",\"b\":\"559B83A79000\",\"o\":\"1C7364A\",\"s\":\"_ZN5mongo37BasicCommandWithReplyBuilderInterface10Invocation3runEPNS_16OperationContextEPNS_3rpc21ReplyBuilderInterfaceE\",\"s+\":\"11A\"},\\{\"a\":\"559B856E6B8F\",\"b\":\"559B83A79000\",\"o\":\"1C6DB8F\",\"s\":\"_ZN5mongo14CommandHelpers20runCommandInvocationEPNS_16OperationContextERKNS_12OpMsgRequestEPNS_17CommandInvocationEPNS_3rpc21ReplyBuilderInterfaceE\",\"s+\":\"7F\"},\\{\"a\":\"559B84E8E665\",\"b\":\"559B83A79000\",\"o\":\"1415665\",\"s\":\"_ZN5mongo12_GLOBAL__N_114runCommandImplEPNS_16OperationContextEPNS_17CommandInvocationERKNS_12OpMsgRequestEPNS_3rpc21ReplyBuilderInterfaceENS_11LogicalTimeERKNS_23ServiceEntryPointCommon5HooksEPNS_14BSONObjBuilderERKNS_30OperationSessionInfoFromClientE\",\"s+\":\"135\"},\\{\"a\":\"559B84E914C9\",\"b\":\"559B83A79000\",\"o\":\"14184C9\",\"s\":\"_ZN5mongo12_GLOBAL__N_119execCommandDatabaseEPNS_16OperationContextEPNS_7CommandERKNS_12OpMsgRequestEPNS_3rpc21ReplyBuilderInterfaceERKNS_23ServiceEntryPointCommon5HooksE\",\"s+\":\"11B9\"},\\{\"a\":\"559B84E927B0\",\"b\":\"559B83A79000\",\"o\":\"14197B0\",\"s\":\"_ZN5mongo12_GLOBAL__N_116receivedCommandsEPNS_16OperationContextERKNS_7MessageERKNS_23ServiceEntryPointCommon5HooksE\",\"s+\":\"650\"},\\{\"a\":\"559B84E9343D\",\"b\":\"559B83A79000\",\"o\":\"141A43D\",\"s\":\"_ZN5mongo23ServiceEntryPointCommon13handleRequestEPNS_16OperationContextERKNS_7MessageERKNS0_5HooksE\",\"s+\":\"50D\"},\\{\"a\":\"559B84E80EEC\",\"b\":\"559B83A79000\",\"o\":\"1407EEC\",\"s\":\"_ZN5mongo23ServiceEntryPointMongod13handleRequestEPNS_16OperationContextERKNS_7MessageE\",\"s+\":\"3C\"},\\{\"a\":\"559B84E8B975\",\"b\":\"559B83A79000\",\"o\":\"1412975\",\"s\":\"_ZN5mongo19ServiceStateMachine15_processMessageENS0_11ThreadGuardE\",\"s+\":\"F5\"},\\{\"a\":\"559B84E89685\",\"b\":\"559B83A79000\",\"o\":\"1410685\",\"s\":\"_ZN5mongo19ServiceStateMachine15_runNextInGuardENS0_11ThreadGuardE\",\"s+\":\"125\"},\\{\"a\":\"559B84E8A616\",\"b\":\"559B83A79000\",\"o\":\"1411616\",\"s\":\"_ZNSt17_Function_handlerIFvvEZN5mongo19ServiceStateMachine22_scheduleNextWithGuardENS2_11ThreadGuardENS1_9transport15ServiceExecutor13ScheduleFlagsENS4_23ServiceExecutorTaskNameENS2_9OwnershipEEUlvE_E9_M_invokeERKSt9_Any_data\",\"s+\":\"56\"},\\{\"a\":\"559B86148162\",\"b\":\"559B83A79000\",\"o\":\"26CF162\",\"s\":\"_ZN5mongo9transport26ServiceExecutorSynchronous8scheduleESt8functionIFvvEENS0_15ServiceExecutor13ScheduleFlagsENS0_23ServiceExecutorTaskNameE\",\"s+\":\"182\"},\\{\"a\":\"559B84E88A9B\",\"b\":\"559B83A79000\",\"o\":\"140FA9B\",\"s\":\"_ZN5mongo19ServiceStateMachine22_scheduleNextWithGuardENS0_11ThreadGuardENS_9transport15ServiceExecutor13ScheduleFlagsENS2_23ServiceExecutorTaskNameENS0_9OwnershipE\",\"s+\":\"DB\"},\\{\"a\":\"559B84E89DFD\",\"b\":\"559B83A79000\",\"o\":\"1410DFD\",\"s\":\"_ZN5mongo19ServiceStateMachine15_sourceCallbackENS_6StatusE\",\"s+\":\"6AD\"},\\{\"a\":\"559B84E89EE0\",\"b\":\"559B83A79000\",\"o\":\"1410EE0\",\"s\":\"_ZN5mongo14future_details4callIRZNS_19ServiceStateMachine14_sourceMessageENS2_11ThreadGuardEEUlNS_10StatusWithINS_7MessageEEEE0_S6_EEDaOT_OT0_\",\"s+\":\"60\"},\\{\"a\":\"559B84E8A185\",\"b\":\"559B83A79000\",\"o\":\"1411185\",\"s\":\"_ZN5mongo19ServiceStateMachine14_sourceMessageENS0_11ThreadGuardE\",\"s+\":\"145\"},\\{\"a\":\"559B84E896FA\",\"b\":\"559B83A79000\",\"o\":\"14106FA\",\"s\":\"_ZN5mongo19ServiceStateMachine15_runNextInGuardENS0_11ThreadGuardE\",\"s+\":\"19A\"},\\{\"a\":\"559B84E8A616\",\"b\":\"559B83A79000\",\"o\":\"1411616\",\"s\":\"_ZNSt17_Function_handlerIFvvEZN5mongo19ServiceStateMachine22_scheduleNextWithGuardENS2_11ThreadGuardENS1_9transport15ServiceExecutor13ScheduleFlagsENS4_23ServiceExecutorTaskNameENS2_9OwnershipEEUlvE_E9_M_invokeERKSt9_Any_data\",\"s+\":\"56\"},\\{\"a\":\"559B861487C8\",\"b\":\"559B83A79000\",\"o\":\"26CF7C8\",\"s\":\"_ZNSt17_Function_handlerIFvvEZN5mongo9transport26ServiceExecutorSynchronous8scheduleESt8functionIS0_ENS2_15ServiceExecutor13ScheduleFlagsENS2_23ServiceExecutorTaskNameEEUlvE0_E9_M_invokeERKSt9_Any_data\",\"s+\":\"B8\"},\\{\"a\":\"559B864991E6\",\"b\":\"559B83A79000\",\"o\":\"2A201E6\",\"s\":\"_ZNSt17_Function_handlerIFvvEZN5mongo25launchServiceWorkerThreadESt8functionIS0_EEUlvE1_E9_M_invokeERKSt9_Any_data\",\"s+\":\"56\"},\\{\"a\":\"559B86499254\",\"b\":\"559B83A79000\",\"o\":\"2A20254\",\"s\":\"_ZN5mongo12_GLOBAL__N_17runFuncEPv\",\"s+\":\"14\"},\\{\"a\":\"7F336A2E9EA5\",\"b\":\"7F336A2E2000\",\"o\":\"7EA5\",\"s\":\"start_thread\",\"s+\":\"C5\"},\\{\"a\":\"7F336A0129FD\",\"b\":\"7F3369F14000\",\"o\":\"FE9FD\",\"s\":\"clone\",\"s+\":\"6D\"}],\"processInfo\":\\{\"mongodbVersion\":\"4.4.4\",\"gitVersion\":\"8db30a63db1a9d84bdcad0c83369623f708e0397\",\"compiledModules\":[],\"uname\":{\"sysname\":\"Linux\",\"release\":\"3.10.0-1160.15.2.el7.x86_64\",\"version\":\"#1 SMP Wed Feb 3 15:06:38 UTC 2021\",\"machine\":\"x86_64\"},\"somap\":[\\{\"b\":\"559B83A79000\",\"elfType\":3,\"buildId\":\"CC93F86C6D00CE717DB23676747D258B4027E066\"},\\{\"b\":\"7F336A2E2000\",\"path\":\"/lib64/libpthread.so.0\",\"elfType\":3,\"buildId\":\"E10CC8F2B932FC3DAEDA22F8DAC5EBB969524E5B\"},\\{\"b\":\"7F3369F14000\",\"path\":\"/lib64/libc.so.6\",\"elfType\":3,\"buildId\":\"7CD4A08C18C60E1E2EA1AEBB88C9379BD7289D38\"}]}}}} \n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n<p>I tried also with the version 4.4.3 but have the same errors.</p>\n\n<p> </p>",
    "environment": "Vmware virtual machines Centos 7.9.\n<br/>\nReplica set 7 nodes ( six db and one arbiter).",
    "key": {
      "id": "1636862",
      "content": "SERVER-54876"
    },
    "summary": "Upgrade mongodb 4.4.4 from 4.2.12 failed",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "9",
      "content": "Done"
    },
    "assignee": {
      "username": "backlog-server-repl",
      "content": "Backlog - Replication Team"
    },
    "reporter": {
      "username": "nicola.battista89@gmail.com",
      "content": "Nicola Battista"
    },
    "labels": {
      "label": [
        "Upgrade/Downgrade",
        "post-rc0"
      ]
    },
    "created": "Tue, 2 Mar 2021 09:41:26 +0000",
    "updated": "Wed, 12 May 2021 16:06:12 +0000",
    "resolved": "Wed, 12 May 2021 16:02:21 +0000",
    "version": [

    ],
    "votes": "0",
    "watches": "11",
    "comments": {
      "comment": [
        {
          "id": "3642724",
          "author": "dmitry.agranat",
          "created": "Tue, 2 Mar 2021 18:49:44 +0000",
          "content": "<p>Hi <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=nicola.battista89%40gmail.com\" class=\"user-hover\" rel=\"nicola.battista89@gmail.com\">Nicola Battista</a>, thank you for the report.</p>\n\n<p>For completeness, could you please compress and upload into <a href=\"https://10gen-httpsupload.s3.amazonaws.com/upload_forms/0d843f11-e3a3-4fa9-8e38-dd018c9fec07.html\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">this secure portal</a>:</p>\n<ul>\n\t<li>full <tt>mongoD</tt> logs and the <tt>$dbpath/diagnostic.data</tt> directory from the original primary covering the time before and during the upgrade?</li>\n\t<li>full <tt>mongoD</tt> logs and the <tt>$dbpath/diagnostic.data</tt> directory from the current primary (which was upgraded from 4.2.12 to 4.4.4 when it was a Secondary) covering the time before and during the upgrade?</li>\n</ul>\n\n\n<p>Thanks,<br/>\nDima</p>"
        },
        {
          "id": "3651553",
          "author": "dmitry.agranat",
          "created": "Mon, 8 Mar 2021 11:06:44 +0000",
          "content": "<p>Hi <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=nicola.battista89%40gmail.com\" class=\"user-hover\" rel=\"nicola.battista89@gmail.com\">Nicola Battista</a>,</p>\n\n<p>We still need additional information to diagnose the problem. If this is still an issue for you, would you please compress and upload it into <a href=\"https://10gen-httpsupload.s3.amazonaws.com/upload_forms/0d843f11-e3a3-4fa9-8e38-dd018c9fec07.html\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">this secure portal</a>:</p>\n<ul>\n\t<li>full mongoD logs and the $dbpath/diagnostic.data directory from the original primary covering the time before and during the upgrade?</li>\n\t<li>full mongoD logs and the $dbpath/diagnostic.data directory from the current primary (which was upgraded from 4.2.12 to 4.4.4 when it was a Secondary) covering the time before and during the upgrade?</li>\n</ul>\n\n\n<p>Thanks,<br/>\nDima</p>"
        },
        {
          "id": "3651580",
          "author": "nicola.battista89@gmail.com",
          "created": "Mon, 8 Mar 2021 11:39:46 +0000",
          "content": "<p>Hi, Being a production database, tomorrow we will replicate the bug again and i'll send you the required logs. </p>\n\n<p>Thank you. </p>\n\n<p>Regards.</p>\n\n<p>Nicola</p>"
        },
        {
          "id": "3663766",
          "author": "nicola.battista89@gmail.com",
          "created": "Mon, 15 Mar 2021 10:03:34 +0000",
          "content": "<p>Hi Dmitry Agranat,</p>\n\n<p>I've sent you  the files in the secure portal.</p>\n\n<p>the name files called : log_tp2-mongo00.tar.gz and log_tp2-mongo01.tar.gz</p>\n\n\n<p>Thank you.</p>\n\n<p>Regards</p>\n\n<p>Nicola</p>"
        },
        {
          "id": "3668372",
          "author": "dmitry.agranat",
          "created": "Wed, 17 Mar 2021 08:48:14 +0000",
          "content": "<p>Hi <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=nicola.battista89%40gmail.com\" class=\"user-hover\" rel=\"nicola.battista89@gmail.com\">Nicola Battista</a>, the uploaded data only contains <tt>diagnostic.data</tt> archive but no <tt>mongod</tt> logs. Can you upload <tt>mongod</tt> logs covering the time of the reported event?</p>"
        },
        {
          "id": "3668380",
          "author": "nicola.battista89@gmail.com",
          "created": "Wed, 17 Mar 2021 09:02:41 +0000",
          "content": "<p>Hi,</p>\n\n<p>i've sent the mongodb logs called mongod_tp2_mongo00.log.gz and mongod_tp2_mongo01.log.gz.</p>\n\n<p>Thanks</p>\n\n<p>Regards</p>\n\n<p>Nicola</p>\n\n<p> </p>"
        },
        {
          "id": "3668668",
          "author": "dmitry.agranat",
          "created": "Wed, 17 Mar 2021 13:00:12 +0000",
          "content": "<p>Thanks <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=nicola.battista89%40gmail.com\" class=\"user-hover\" rel=\"nicola.battista89@gmail.com\">Nicola Battista</a> for uploading <tt>mongodb</tt> logs. I have another question, what is the current <tt>featureCompatibilityVersion</tt> on all 7 members of this replica set? To view the <tt>featureCompatibilityVersion</tt> for a mongod instance, run the following command on each mongod instance:</p>\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>"
        },
        {
          "id": "3668883",
          "author": "nicola.battista89@gmail.com",
          "created": "Wed, 17 Mar 2021 14:15:54 +0000",
          "content": "<p>Hi,</p>\n\n<p>All nodes have this output : </p>\n\n<p> db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )<br/>\n{<br/>\n \"featureCompatibilityVersion\" : </p>\n{\n \"version\" : \"4.2\"\n }\n<p>,<br/>\n \"ok\" : 1,<br/>\n \"$clusterTime\" : {<br/>\n \"clusterTime\" : Timestamp(1615988483, 684),<br/>\n \"signature\" : </p>\n{\n \"hash\" : BinData(0,\"EFp6D8mRrtb88nUTJ2zWtnX/SO0=\"),\n \"keyId\" : NumberLong(\"6919393090692186131\")\n }\n<p> },<br/>\n \"operationTime\" : Timestamp(1615988483, 683)</p>\n\n<p> </p>\n\n<p>Thanks</p>\n\n<p>Regards.</p>\n\n<p>Nicola</p>\n\n<p> </p>"
        },
        {
          "id": "3668910",
          "author": "dmitry.agranat",
          "created": "Wed, 17 Mar 2021 14:21:59 +0000",
          "content": "<p>Thanks <a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=nicola.battista89%40gmail.com\" class=\"user-hover\" rel=\"nicola.battista89@gmail.com\">Nicola Battista</a>. We're assigning this ticket to the appropriate team to be further investigated. Updates will be posted on this ticket as they happen.</p>"
        },
        {
          "id": "3706421",
          "author": "matthew.russotto",
          "created": "Wed, 7 Apr 2021 19:59:40 +0000",
          "content": "<p><a href=\"https://jira.mongodb.org/secure/ViewProfile.jspa?name=dmitry.agranat\" class=\"user-hover\" rel=\"dmitry.agranat\">Dmitry Agranat</a><br/>\nI have been able to create a reproduction of this bug but it requires a somewhat unusual sequence of events and I would like to confirm if it was possible before going forward.</p>\n\n<p>What would be required is that the arbiter was at one point not an arbiter, and wrote some oplog entries with a walltime of 0 (which could have happened in some previous versions).  Then it became an arbiter; we would continue to send that last oplog time as the last durable optime of the arbiter, which would crash a 4.4 node.</p>\n\n<p>So to check this, I would like to see if we can get the last entry in the oplog collection (local.oplog.rs) on the arbiter.  There really shouldn't be such a collection; if there isn't, that isn't the problem.</p>"
        },
        {
          "id": "3706458",
          "author": "nicola.battista89@gmail.com",
          "created": "Wed, 7 Apr 2021 20:17:18 +0000",
          "content": "<p>Hi Matthew,</p>\n\n<p>On the Arbiter :</p>\n\n<p>xxx-mongodb:ARBITER&gt; use local<br/>\nswitched to db local<br/>\nxxx-mongodb:ARBITER&gt; show collections;<br/>\noplog.rs<br/>\nreplset.election<br/>\nreplset.minvalid<br/>\nreplset.oplogTruncateAfterPoint<br/>\nstartup_log<br/>\nsystem.replset<br/>\nsystem.rollback.id<br/>\nxxx-mongodb:ARBITER&gt; db.oplog.rs.find()<br/>\nxxx-mongodb:ARBITER&gt; <br/>\nxxx-mongodb:ARBITER&gt;</p>\n\n<p> </p>\n\n<p>Regards</p>\n\n<p>Nicola</p>"
        },
        {
          "id": "3754669",
          "author": "matthew.russotto",
          "created": "Tue, 4 May 2021 17:09:12 +0000",
          "content": "<p>It turns out we can get an optime/wall time which is a \"ghost in the machine\".  If an arbiter gets a durable optime/wall time at any point (which can happen if it goes into REMOVED while it has an oplog entry; there may be other bugs which can cause this), that optime will be passed to the other members of the set.  Even if the arbiter is subsequently restarted or even resynced, that durable optime will be greater than the (correct) null durable optime the arbiter is sending in heartbeats, so it will remain in the state of the other nodes in the system, which will pass it around using replSetUpdatePosition.</p>\n"
        },
        {
          "id": "3769459",
          "author": "matthew.russotto",
          "created": "Wed, 12 May 2021 16:02:21 +0000",
          "content": "<p>Investigation is complete; fix will be tracked as <a href=\"https://jira.mongodb.org/browse/SERVER-56619\" title=\"Arbiters should explicitly clear their durable optime\" class=\"issue-link\" data-issue-key=\"SERVER-56619\">SERVER-56619</a> and <a href=\"https://jira.mongodb.org/browse/SERVER-56620\" title=\"Nodes should explicitly clear arbiter durableOpTimeAndWalltime\" class=\"issue-link\" data-issue-key=\"SERVER-56620\"><del>SERVER-56620</del></a>.</p>"
        }
      ]
    },
    "issuelinks": {
      "issuelinktype": [
        {
          "id": "10420",
          "name": "Backports",
          "outwardlinks": {
            "description": "backported by"
          }
        },
        {
          "id": "10010",
          "name": "Duplicate",
          "inwardlinks": {
            "description": "is duplicated by",
            "issuelink": {
              "issuekey": {
                "id": "1681221",
                "content": "SERVER-56129"
              }
            }
          }
        },
        {
          "id": "10620",
          "name": "Issue split",
          "outwardlinks": {
            "description": "split to",
            "issuelink": [
              {
                "issuekey": {
                  "id": "1700715",
                  "content": "SERVER-56619"
                }
              },
              {
                "issuekey": {
                  "id": "1700728",
                  "content": "SERVER-56620"
                }
              }
            ]
          }
        }
      ]
    },
    "attachments": {
      "attachment": [
        {
          "id": "302465",
          "name": "mongod.log.rpmsave.gz",
          "size": "148455",
          "author": "nicola.battista89@gmail.com",
          "created": "Tue, 2 Mar 2021 09:38:11 +0000"
        },
        {
          "id": "302565",
          "name": "mongod.log.rpmsave.zip",
          "size": "148593",
          "author": "dmitry.agranat",
          "created": "Tue, 2 Mar 2021 18:09:48 +0000"
        }
      ]
    },
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "13.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "3.0"
          }
        },
        {
          "id": "customfield_12450",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes",
          "customfieldname": "Backport Requested",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "18953",
              "content": "v4.4"
            }
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Tue, 2 Mar 2021 13:32:44 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        19 weeks, 1 day ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "matthew.russotto"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            19 weeks, 1 day ago\n                        "
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "backlog-server-repl",
              "dmitry.agranat",
              "matthew.russotto",
              "nicola.battista89@gmail.com"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyxf0v:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyz353:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": [
              {
                "id": "4853",
                "content": "Repl 2021-04-19"
              },
              {
                "id": "4858",
                "content": "Repl 2021-05-03"
              },
              {
                "id": "4859",
                "content": "Repl 2021-05-17"
              }
            ]
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyx19z:"
          }
        }
      ]
    }
  },
  {
    "title": "[SERVER-54878] Compact can log incorrect value for freedBytes",
    "link": "https://jira.mongodb.org/browse/SERVER-54878",
    "project": {
      "id": "10000",
      "key": "SERVER",
      "content": "Core Server"
    },
    "description": "<p>When compacting a collection that is actively being written it is possible that the collection is larger at the completion of compaction than when it started; I assume that this is an expected outcome. In this case the operation returns a negative number for bytesFreed:</p>\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">{</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\"bytesFreed\" : -339968,</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\"ok\" : 1,</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\"$clusterTime\" : {</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\t\"clusterTime\" : Timestamp(1614690587, 925),</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\t\"signature\" : {</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\t\t\"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"),</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\t\t\"keyId\" : NumberLong(0)</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\t}</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t},</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">\t\"operationTime\" : Timestamp(1614690587, 898)</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">}\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p>Whereas an absurdly large value is logged for freedBytes:</p>\n<p/>\n<div id=\"syntaxplugin\" class=\"syntaxplugin\" style=\"border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;\">\n<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;\">\n\t\t<tbody >\n\t\t\t\t<tr id=\"syntaxplugin_code_and_gutter\">\n\t\t\t\t\t\t<td  style=\" line-height: 1.4em !important; padding: 0em; vertical-align: top;\">\n\t\t\t\t\t<pre style=\"font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;\"><span style=\"color: black; font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;\">{\"t\":{\"$date\":\"2021-03-02T08:09:47.634-05:00\"},\"s\":\"I\",  \"c\":\"STORAGE\",  \"id\":20286,   \"ctx\":\"conn24\",\"msg\":\"Compact end\",\"attr\":{\"namespace\":\"test.c\",\"freedBytes\":18446744073709211648}}\n</span></pre>\n\t\t\t</td>\n\t\t</tr>\n\t\t\t</tbody>\n</table>\n</div>\n<p/>\n\n<p>It looks like compactCollection is incorrectly treating the negative signed value as unsigned when it logs it.</p>\n\n<p>Possibly both values should be logged as 0, since logging a negative value may make it appear that compact is malfunctioning.</p>\n\n<p>Also, it would be good to make the command result and the log statement consistent; suggest changing the log statement to use \"bytesFreed\" as it seems less likely that users will be affected by changing the log statement than by changing the command return.</p>\n",
    "environment": "",
    "key": {
      "id": "1636937",
      "content": "SERVER-54878"
    },
    "summary": "Compact can log incorrect value for freedBytes",
    "type": {
      "id": "1",
      "iconUrl": "https://jira.mongodb.org/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype",
      "content": "Bug"
    },
    "priority": {
      "id": "3",
      "iconUrl": "https://jira.mongodb.org/images/icons/priorities/major.svg",
      "content": "Major - P3"
    },
    "status": {
      "id": "6",
      "iconUrl": "https://jira.mongodb.org/images/icons/statuses/closed.png",
      "description": "The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.",
      "content": "Closed"
    },
    "statusCategory": {
      "id": "3",
      "key": "done",
      "colorName": "green"
    },
    "resolution": {
      "id": "1",
      "content": "Fixed"
    },
    "assignee": {
      "username": "gregory.wlodarek",
      "content": "Gregory Wlodarek"
    },
    "reporter": {
      "username": "bruce.lucas",
      "content": "Bruce Lucas"
    },
    "labels": {
      "label": "newgrad"
    },
    "created": "Tue, 2 Mar 2021 13:35:19 +0000",
    "updated": "Tue, 25 May 2021 22:14:05 +0000",
    "resolved": "Wed, 5 May 2021 23:26:36 +0000",
    "version": [

    ],
    "fixVersion": [
      "4.4.7",
      "5.0.0-rc0"
    ],
    "votes": "0",
    "watches": "7",
    "comments": {
      "comment": [
        {
          "id": "3757793",
          "author": "xgen-internal-githook",
          "created": "Wed, 5 May 2021 22:32:57 +0000",
          "content": "<p>Author:</p>\n{'name': 'Gregory Wlodarek', 'email': 'gregory.wlodarek@mongodb.com', 'username': 'GWlodarek'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-54878\" title=\"Compact can log incorrect value for freedBytes\" class=\"issue-link\" data-issue-key=\"SERVER-54878\"><del>SERVER-54878</del></a> Compact can log negative value for bytesFreed<br/>\nBranch: master<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/c48ddf533938bc4ae85ae120b63c1de0ee290e26\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/c48ddf533938bc4ae85ae120b63c1de0ee290e26</a></p>"
        },
        {
          "id": "3763716",
          "author": "xgen-internal-githook",
          "created": "Mon, 10 May 2021 14:43:50 +0000",
          "content": "<p>Author:</p>\n{'name': 'Gregory Wlodarek', 'email': 'gregory.wlodarek@mongodb.com', 'username': 'GWlodarek'}\n<p>Message: <a href=\"https://jira.mongodb.org/browse/SERVER-54878\" title=\"Compact can log incorrect value for freedBytes\" class=\"issue-link\" data-issue-key=\"SERVER-54878\"><del>SERVER-54878</del></a> Compact can log negative value for bytesFreed</p>\n\n<p>(cherry picked from commit c48ddf533938bc4ae85ae120b63c1de0ee290e26)<br/>\nBranch: v4.4<br/>\n<a href=\"https://github.com/mongodb/mongo/commit/fd200767a125ac704ebd67630246eccfc2670120\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">https://github.com/mongodb/mongo/commit/fd200767a125ac704ebd67630246eccfc2670120</a></p>"
        }
      ]
    },
    "issuelinks": {
      "issuelinktype": {
        "id": "10420",
        "name": "Backports",
        "outwardlinks": {
          "description": "backported by"
        }
      }
    },
    "attachments": "",
    "subtasks": "",
    "customfields": {
      "customfield": [
        {
          "id": "customfield_10050",
          "key": "com.atlassian.jira.toolkit:comments",
          "customfieldname": "# Replies",
          "customfieldvalues": {
            "customfieldvalue": "2.0"
          }
        },
        {
          "id": "customfield_18555",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "# of Sprints",
          "customfieldvalues": {
            "customfieldvalue": "1.0"
          }
        },
        {
          "id": "customfield_12450",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes",
          "customfieldname": "Backport Requested",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "18953",
              "content": "v4.4"
            }
          }
        },
        {
          "id": "customfield_10011",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Backwards Compatibility",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10038",
              "content": "Fully Compatible"
            }
          }
        },
        {
          "id": "customfield_10055",
          "key": "com.atlassian.jira.ext.charting:firstresponsedate",
          "customfieldname": "Date of 1st Reply",
          "customfieldvalues": {
            "customfieldvalue": "Wed, 5 May 2021 20:27:37 +0000"
          }
        },
        {
          "id": "customfield_10052",
          "key": "com.atlassian.jira.toolkit:dayslastcommented",
          "customfieldname": "Days since reply",
          "customfieldvalues": "\n                                        19 weeks, 3 days ago\n    \n                        "
        },
        {
          "id": "customfield_18254",
          "key": "com.onresolve.jira.groovy.groovyrunner:scripted-field",
          "customfieldname": "Dependencies",
          "customfieldvalues": {
            "customfieldvalue": ""
          }
        },
        {
          "id": "customfield_15850",
          "key": "com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary",
          "customfieldname": "Development",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_17050",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons",
          "customfieldname": "Downstream Team Attention",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "16941",
              "content": "Not Needed"
            }
          }
        },
        {
          "id": "customfield_10857",
          "key": "com.pyxis.greenhopper.jira:gh-epic-link",
          "customfieldname": "Epic Link",
          "customfieldvalues": {
            "customfieldvalue": "PM-2057"
          }
        },
        {
          "id": "customfield_10057",
          "key": "com.atlassian.jira.toolkit:lastusercommented",
          "customfieldname": "Last comment by Customer",
          "customfieldvalues": {
            "customfieldvalue": "true"
          }
        },
        {
          "id": "customfield_10056",
          "key": "com.atlassian.jira.toolkit:lastupdaterorcommenter",
          "customfieldname": "Last commenter",
          "customfieldvalues": {
            "customfieldvalue": "vivian.ge"
          }
        },
        {
          "id": "customfield_11151",
          "key": "com.atlassian.jira.toolkit:LastCommentDate",
          "customfieldname": "Last public comment date",
          "customfieldvalues": "\n                            19 weeks, 3 days ago\n                        "
        },
        {
          "id": "customfield_10032",
          "key": "com.atlassian.jira.plugin.system.customfieldtypes:select",
          "customfieldname": "Operating System",
          "customfieldvalues": {
            "customfieldvalue": {
              "key": "10026",
              "content": "ALL"
            }
          }
        },
        {
          "id": "customfield_10051",
          "key": "com.atlassian.jira.toolkit:participants",
          "customfieldname": "Participants",
          "customfieldvalues": {
            "customfieldvalue": [
              "bruce.lucas",
              "xgen-internal-githook",
              "gregory.wlodarek"
            ]
          }
        },
        {
          "id": "customfield_14254",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Product Rank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyxfhj:"
          }
        },
        {
          "id": "customfield_12550",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "Rank",
          "customfieldvalues": {
            "customfieldvalue": "0|i02nnb:"
          }
        },
        {
          "id": "customfield_10558",
          "key": "com.pyxis.greenhopper.jira:gh-global-rank",
          "customfieldname": "Rank (Obsolete)",
          "customfieldvalues": {
            "customfieldvalue": "9223372036854775807"
          }
        },
        {
          "id": "customfield_10557",
          "key": "com.pyxis.greenhopper.jira:gh-sprint",
          "customfieldname": "Sprint",
          "customfieldvalues": {
            "customfieldvalue": {
              "id": "4828",
              "content": "Execution Team 2021-05-17"
            }
          }
        },
        {
          "id": "customfield_10053",
          "key": "com.atlassian.jira.ext.charting:timeinstatus",
          "customfieldname": "Time In Status",
          "customfieldvalues": ""
        },
        {
          "id": "customfield_14350",
          "key": "com.pyxis.greenhopper.jira:gh-lexo-rank",
          "customfieldname": "serverRank",
          "customfieldvalues": {
            "customfieldvalue": "1|hyx1qn:"
          }
        }
      ]
    }
  }
]
